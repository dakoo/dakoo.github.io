<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Data Structure - LRU(Least Recently Used) - Clean Code</title> <meta name="Description" content="LRU Cache"> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Data Structure - LRU(Least Recently Used) | Clean Code</title> <meta name="generator" content="Jekyll v3.8.6" /> <meta property="og:title" content="Data Structure - LRU(Least Recently Used)" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="LRU Cache" /> <meta property="og:description" content="LRU Cache" /> <link rel="canonical" href="http://localhost:4000/docs/codingInterview/2016-02-29-data-structure-LRU-cache.html" /> <meta property="og:url" content="http://localhost:4000/docs/codingInterview/2016-02-29-data-structure-LRU-cache.html" /> <meta property="og:site_name" content="Clean Code" /> <script type="application/ld+json"> {"description":"LRU Cache","@type":"WebPage","url":"http://localhost:4000/docs/codingInterview/2016-02-29-data-structure-LRU-cache.html","headline":"Data Structure - LRU(Least Recently Used)","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000" class="site-title lh-tight">Clean Code</a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="http://localhost:4000/404.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="http://localhost:4000/" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="http://localhost:4000/docs/codingInterview" class="navigation-list-link">Coding Interview</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2018-07-28-algorithm-sliding-window.html" class="navigation-list-link">Algorithm - sliding window algorithm</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-dijkstra-algorithm.html" class="navigation-list-link">Algorithm - Dijkstra's shortest path</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-disjoints-set.html" class="navigation-list-link">Data Structure - disjoints-set</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-priority-queue.html" class="navigation-list-link">Data Structure - Priority Queue</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-07-mst-kruskal.html" class="navigation-list-link">Algorithm - Minimum Spanning Tree - Kruskal</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-11-string-pattern-search.html" class="navigation-list-link">Algorithm - 문자열 패턴 검색 보이어-무어 알고리즘에 대한 이해와 구현</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-12-substring-sorting.html" class="navigation-list-link">Algorithm - 부분 문자열의 사전순 정렬</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-14-Longest%20Increasing%20Subsequence.html" class="navigation-list-link">Algorithm - LIS(Longest Increasing Subsequence) O(N*N) 알고리즘</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-14-floyd-warshall.html" class="navigation-list-link">Algorithm - Floyd-Warshall</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-14-probability_summary.html" class="navigation-list-link">Algorithm - 확률에 대한 간단 정리</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-01knapsack.html" class="navigation-list-link">Algorithm - 0-1 Knapsack 알고리즘</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-longest-common-subsequence.html" class="navigation-list-link">Algorithm - LCS(Longest Common Subsequence) 알고리즘</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-permutation-composition-summary.html" class="navigation-list-link">Algorithm - 순열과 조합</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-travelling-salesman-problem.html" class="navigation-list-link">Algorithm - Travelling Salesman Problem(TSP)</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-16-independent_probability_problem.html" class="navigation-list-link">Algorithm - 독립 시행 확률</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-27-combination-in-c.html" class="navigation-list-link">Algorithm - combination</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-05-algorithm-quicksort.html" class="navigation-list-link">Algorithm - quick sort</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-09-algorithm-bisectional-search.html" class="navigation-list-link">Algorithm - 이분 탐색</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-09-algorithm-longest-increasing-subsequence-nlogn.html" class="navigation-list-link">Algorithm - Longest Increasing Subsequence</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-09-algorithm-maximum-sum-subarray.html" class="navigation-list-link">Algorithm - maximum sum subarray</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-13-data-structure-hash-table.html" class="navigation-list-link">Data Structure - hash table</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-14-data-structure-binary-search-tree.html" class="navigation-list-link">Data Structure - binary search tree</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-15-data-structure-binary-tree-problems.html" class="navigation-list-link">Algorithm - binary tree 및 binary search tree 문제들</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-22-algorithm-find-kth-item.html" class="navigation-list-link">Algorithm - k번째 큰(작은) 아이템 찾기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-22-algorithm-merge-sort.html" class="navigation-list-link">Algorithm - merge sort</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-25-algorithm-topological-sort.html" class="navigation-list-link">Algorithm - Topological Sort</a></li><li class="navigation-list-item active"><a href="http://localhost:4000/docs/codingInterview/2016-02-29-data-structure-LRU-cache.html" class="navigation-list-link active">Data Structure - LRU(Least Recently Used)</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-03-01-algorithm-2d-matrix-rotation.html" class="navigation-list-link">Algorithm - 2D Matrix 회전</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-03-03-data-structure-b-tree.html" class="navigation-list-link">Data Structure - B-tree</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-algorithm-dfs-bfs.html" class="navigation-list-link">Algorithm - DFS와 BFS</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/java" class="navigation-list-link">Java</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-11-27-java-intellij-shortcut.html" class="navigation-list-link">Java - OSX에서 vim 모드와 함께 쓸 만한 Intellij 단축키</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-23-java-collections-api.html" class="navigation-list-link">Java - Collections API</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-23-java-comparable-comparator.html" class="navigation-list-link">Java - Comparable과 Comparator</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-23-java-lambda.html" class="navigation-list-link">Java - Lambda</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-29-java-collection-framework.html" class="navigation-list-link">Java - Collection Framework</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-30-java-collection-list.html" class="navigation-list-link">Java - List 인터페이스</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-31-java-arraylist.html" class="navigation-list-link">Java - ArrayList 클래스</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-31-java-linkedlist.html" class="navigation-list-link">Java - LinkedList 클래스</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-04-java-stream.html" class="navigation-list-link">Java - Stream</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-06-java-stringbuilder.html" class="navigation-list-link">Java - StringBuilder</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-12-java-comparator-interface.html" class="navigation-list-link">Java - Comparator Interface 사용</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-12-java-generic-function.html" class="navigation-list-link">Java - Generic function</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-13-java-bitset.html" class="navigation-list-link">Java - BitSet class 예제</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-13-java-priority-queue.html" class="navigation-list-link">Java - Priority Queue</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-15-java-multithreading-thread-thread-implementation.html" class="navigation-list-link">Java - (멀티쓰레딩 1) Thread 구현</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-16-java-multithreading-executor-basic.html" class="navigation-list-link">Java - (멀티쓰레딩 2) Executor 기본</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-16-java-vararg-stream-conversion.html" class="navigation-list-link">Java - vararg을 stream으로 변환</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-17-java-annotation.html" class="navigation-list-link">Java - Annotation</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-17-java-name-threads.html" class="navigation-list-link">Java - (멀티쓰레딩 3) 쓰레드 이름 설정</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-18-java-mulitthreading-daemon-thread.html" class="navigation-list-link">Java - (멀티쓰레딩 5) 데몬 쓰레드</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-18-java-multithreading-returning-values-from-task.html" class="navigation-list-link">Java - (멀티쓰레딩 4) 쓰레드에서 값 반환</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-19-java-multithreading-check-aliveness.html" class="navigation-list-link">Java - (멀티쓰레딩 6) 쓰레드 동작의 완료를 확인하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-exception-handling.html" class="navigation-list-link">Java - (멀티쓰레딩 8) 쓰레드 Exception 처리하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-join.html" class="navigation-list-link">Java - (멀티쓰레딩 9) 쓰레드 Join하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-scheduling.html" class="navigation-list-link">Java - (멀티쓰레딩 10) 쓰레드 스케쥴링</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-termination.html" class="navigation-list-link">Java - (멀티쓰레딩 7) 쓰레드 중지하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-10-02-java-naming.html" class="navigation-list-link">Java - 네이밍</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-10-12-java-final-keyword.html" class="navigation-list-link">Java - final 키워드</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-10-14-java-lombok.html" class="navigation-list-link">Java - Lombok</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-22-java-big-number.html" class="navigation-list-link">Java - Big Number(BigInteger와 BigDecimal)</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/javascript" class="navigation-list-link">Javascript</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/javascript/2015-08-24-everything-about-javascript-scope.html" class="navigation-list-link">Javascript - scope에 대해 알고자 했던 모든 것</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/javascript/2018-02-22-javascript-best-deepcopy.html" class="navigation-list-link">Javascript - deep copy가 필요할 때 무얼 사용해야 할까?</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/systemDesignInterview" class="navigation-list-link">System Design Interview</a><ul class="navigation-list-child-list "></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/tool" class="navigation-list-link">Tool</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-tool-notification-after-job-finish-mac-terminal.html" class="navigation-list-link">Tool - Mac에서 터미널 작업 실행후 notification</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-10-04-git-pull-request.html" class="navigation-list-link">Git - pull request</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-10-05-git-revert-changes.html" class="navigation-list-link">Git - 수정한 것 되돌리기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-11-03-bash-find-pattern-in-directories.html" class="navigation-list-link">shell - 폴더에서 파일 내용 검색하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-11-07-git-diff.html" class="navigation-list-link">Git - diff 사용하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-11-08-how-to-patch.html" class="navigation-list-link">Tool - patch하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-12-30-tool-grep-remove-useless-lines.html" class="navigation-list-link">grep 명령 - 빈 줄이나 특정 줄 제거하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-12-30-tool-sed-replace-string.html" class="navigation-list-link">sed 명령 - 특정 문자열을 변경하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-12-30-tool-sort-reverse-order.html" class="navigation-list-link">sort 명령 - 크기 역순으로 정렬하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2017-01-07-linux-useful-bash-commands.html" class="navigation-list-link">유용한 bash 명령들</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2017-03-13-uml-plantuml.html" class="navigation-list-link">uml - plantuml</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-quick-directory-alias.html" class="navigation-list-link">Tool - Quick directory alias</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-run-command-in-new-terminal-tab.html" class="navigation-list-link">Tool - Mac iterm2에서 작업을 다른 tab에서 실행하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-run-ssh-in-new-terminal-tab.html" class="navigation-list-link">Tool - Mac iterm2에서 ssh를 다른 tab에서 실행하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2015-07-21-uml-tools.html" class="navigation-list-link">Design - 좋은 UML 툴 추천</a></li></ul></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Clean Code" aria-label="Search Clean Code" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> </div> <div class="page"> <nav class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/codingInterview">Coding Interview</a></li> <li class="breadcrumb-nav-list-item"><span>Data Structure - LRU(Least Recently Used)</span></li> </ol> </nav> <div id="main-content" class="page-content" role="main"> <p>직접 구현해 본 LRU Cache. O(1) 시간 복잡도로 lookup과 put을 만족시키기 위해서는 Entry에 access하는 것도 O(1)이고 LRU인지 판별하는 것도 O(1)으로 해야 한다. 이를 위해 ks(C++은 unordered_map)과 doubly linked list를 사용했다. Cache Replacement가 실행되는 것은 Cache가 full인 것은 unordered_map의 size()가 미리 정한 entry의 갯수에 도달했을 경우이다.</p> <h3 id="구조"> <a href="#구조" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 구조 </h3> <p>입력 데이터는 key와 value 조합으로 했으며, 삽입, 검색, 삭제의 기준은 key로 했다. 삽입, 삭제를 O(1)만에 하기 위해 singly linked list가 아닌 doubly linked list로 했다. 이를 Item의 member variable로 가지고 있으며, hashtable에 그대로 저장되도록 했다. 구현을 용이하게 하기 위해 constructor를 담은 struct로 정의했다.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Item</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">key</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">Item</span> <span class="o">*</span><span class="n">prev</span><span class="p">;</span>
    <span class="n">Item</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="n">Item</span><span class="p">(</span><span class="n">string</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span><span class="o">:</span> <span class="n">key</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">value</span><span class="p">(</span><span class="n">v</span><span class="p">){</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">};</span>
</code></pre></div></div> <p>public interface인 함수 프로토타입은 Cache라는 base class를 사용하여 다음과 같이 선언했다. Cache는 interface로만 동작하므로 pure virtual class이다.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Cache</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">lookup</span><span class="p">(</span><span class="n">string</span> <span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">put</span><span class="p">(</span><span class="n">string</span> <span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div> <p>LRUCache class는 실제 구현을 포함하고 있으며 그 private 멤버는 다음과 같이 도출했으며 그 구현은 통상적은 doubly linked list의 operation과 같다.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">LRUCache</span><span class="o">:</span> <span class="k">public</span> <span class="n">Cache</span><span class="p">{</span>
<span class="nl">private:</span>
    <span class="cm">/* Linked list 관련 */</span>
    <span class="n">Item</span> <span class="o">*</span><span class="n">head</span><span class="p">;</span>  <span class="c1">//가장 최근에 참조된 아이템을 가리킴 (head-&gt;next)</span>
    <span class="n">Item</span> <span class="o">*</span><span class="n">tail</span><span class="p">;</span>  <span class="c1">//가장 오래전에 참조된 아이템을 가리킴 (tail-&gt;prev)</span>
    <span class="kt">void</span> <span class="n">detach</span><span class="p">(</span><span class="n">Item</span> <span class="o">*</span><span class="n">item</span><span class="p">);</span> <span class="c1">//linked list에서 item을 제거</span>
    <span class="kt">void</span> <span class="n">push_front</span><span class="p">(</span><span class="n">Item</span> <span class="o">*</span><span class="n">item</span><span class="p">);</span> <span class="c1">//linked list의 head에 item 추가(newest)</span>
    <span class="kt">void</span> <span class="n">pop_back</span><span class="p">();</span> <span class="c1">//linked list의 tail이 가리키는 아이템(oldest) 제거</span>
    <span class="kt">bool</span> <span class="n">back</span><span class="p">(</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">);</span> <span class="c1">//가장 오래전에 참조된 아이템의 key 획득, 없으면 false</span>

    <span class="cm">/* Hashtable 관련 */</span>
    <span class="kt">int</span> <span class="n">MaxNumEntries</span><span class="p">;</span>
    <span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="n">Item</span><span class="o">*&gt;</span> <span class="n">CacheEntries</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div> <p>LRUCache의 publc member의 구현을 살펴보자. 먼저 Constructor와 destructor는 linked list를 초기화하거나 제거한다.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LRUCache</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span><span class="o">:</span><span class="n">MaxNumEntries</span><span class="p">(</span><span class="n">num</span><span class="p">){</span>
    <span class="c1">//head &lt;-&gt; tail</span>
    <span class="n">head</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">(</span><span class="s">"0"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">tail</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">(</span><span class="s">"0"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">tail</span><span class="p">;</span>
    <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
<span class="p">};</span>
<span class="o">~</span><span class="n">LRUCache</span><span class="p">(){</span>
    <span class="k">while</span><span class="p">(</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">!=</span> <span class="n">tail</span><span class="p">){</span>
        <span class="n">pop_back</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">delete</span> <span class="n">head</span><span class="p">;</span>
    <span class="k">delete</span> <span class="n">tail</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Lookup method는 Hashtable에서 해당하는 key가 존재하는지 확인하고 존재하면 그것의 value를 반환한다. 이때, Linked List에서 해당 아이템을 찾아서 그것을 맨 앞으로 이동시킨다.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">string</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">){</span>
    <span class="cm">/* find a matching item */</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">it</span> <span class="o">==</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span> <span class="c1">//not found</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span> <span class="c1">//found</span>
    <span class="cm">/* update linked list */</span>
    <span class="n">detach</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//detach</span>
    <span class="n">push_front</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//add to the head because this is the latest</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Put method는 Hashtable에서 해당하는 key가 존재하는지 먼저 찾는다. 존재한다면 value를 update하고 Lookup method처럼 Linked List에서 해당 아이템을 찾아서 맨 앞으로 이동시킨다. 존재하지 않는다면 다음의 두가지 경우를 고려해야 한다.</p> <ul> <li>Hashtable의 아이템 숫자가 미리 정한 숫자에 도달하지 않은 경우: 아이템을 Hashtable에 추가하고, LinkedList의 맨 앞에도 추가한다.</li> <li>Hashtable의 아이템 숫자가 미리 정한 숫자에 도달한 경우(Full): Linked List의 맨 뒤에서 가장 오래전에 참조된 아이템의 key를 획득하고, 그 아이템을 Linked List와 Hashtable에서 제거한다. 그 뒤 새로운 아이템을 Hashtable에 추가하고 Linked List의 맨 앞에 추가한다.</li> </ul> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">put</span><span class="p">(</span><span class="n">string</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">){</span>
    <span class="cm">/* find a matching item: O(1) operation */</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span> <span class="c1">//found</span>
        <span class="cm">/* update data */</span>
        <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
        <span class="cm">/* update linked list */</span>
        <span class="n">detach</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//detach</span>
        <span class="n">push_front</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//add to the head because this is the latest</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/* Add new one: O(1) operation */</span>
    <span class="k">if</span><span class="p">(</span><span class="n">CacheEntries</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">MaxNumEntries</span><span class="p">){</span> <span class="c1">//Cache is NOT full</span>
        <span class="n">Item</span> <span class="o">*</span><span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">Item</span> <span class="o">*&gt;</span> <span class="n">entry</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
        <span class="n">CacheEntries</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
        <span class="n">push_front</span><span class="p">(</span><span class="n">t</span><span class="p">);</span> <span class="c1">//Latest one</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">//Cache is full</span>
        <span class="cm">/* Select Victim &amp; delete */</span>
        <span class="n">string</span> <span class="n">key</span><span class="p">;</span>
        <span class="n">back</span><span class="p">(</span><span class="n">key</span><span class="p">);</span> <span class="c1">//get the key of the oldest one</span>
        <span class="n">pop_back</span><span class="p">();</span>       <span class="c1">//remove the oldest one</span>
        <span class="k">auto</span> <span class="n">rt</span> <span class="o">=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">rt</span> <span class="o">!=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span> <span class="c1">//found</span>
            <span class="n">CacheEntries</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span> <span class="c1">//delete</span>
        <span class="p">}</span>
        <span class="n">Item</span> <span class="o">*</span><span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">Item</span> <span class="o">*&gt;</span> <span class="n">entry</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
        <span class="n">CacheEntries</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
        <span class="n">push_front</span><span class="p">(</span><span class="n">t</span><span class="p">);</span> <span class="c1">//Latest one</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="code"> <a href="#code" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> code </h3> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;iostream&gt;
#include &lt;unordered_map&gt;
#include &lt;string&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">Item</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">key</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">Item</span> <span class="o">*</span><span class="n">prev</span><span class="p">;</span>
    <span class="n">Item</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="n">Item</span><span class="p">(</span><span class="n">string</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span><span class="o">:</span> <span class="n">key</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">value</span><span class="p">(</span><span class="n">v</span><span class="p">){</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Cache</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">lookup</span><span class="p">(</span><span class="n">string</span> <span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">put</span><span class="p">(</span><span class="n">string</span> <span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">LRUCache</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Cache</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="cm">/* Doubly Linked List: Head - The most recent, Tail - The least recent */</span>
    <span class="n">Item</span> <span class="o">*</span><span class="n">head</span><span class="p">;</span>
    <span class="n">Item</span> <span class="o">*</span><span class="n">tail</span><span class="p">;</span>
    <span class="kt">void</span> <span class="n">detach</span><span class="p">(</span><span class="n">Item</span> <span class="o">*</span><span class="n">item</span><span class="p">){</span> <span class="c1">//Detach item from linked list : O(1)</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kt">void</span> <span class="n">push_front</span><span class="p">(</span><span class="n">Item</span> <span class="o">*</span><span class="n">item</span><span class="p">){</span> <span class="c1">//Add the new item at the front : O(1)</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">item</span><span class="p">;</span>
        <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">item</span><span class="p">;</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kt">void</span> <span class="n">pop_back</span><span class="p">(){</span> <span class="c1">//delete item from the tail : O(1)</span>
        <span class="n">Item</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">item</span> <span class="o">!=</span> <span class="n">head</span><span class="p">){</span>
            <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
            <span class="k">delete</span> <span class="n">item</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">tail</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kt">bool</span> <span class="n">back</span><span class="p">(</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">){</span> <span class="c1">//Get the item from the tail: O(1)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">==</span> <span class="n">head</span><span class="p">){</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="cm">/* Hash Table */</span>
    <span class="kt">int</span> <span class="n">MaxNumEntries</span><span class="p">;</span>
    <span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="n">Item</span><span class="o">*&gt;</span> <span class="n">CacheEntries</span><span class="p">;</span>
<span class="nl">public:</span>
    <span class="n">LRUCache</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span><span class="o">:</span><span class="n">MaxNumEntries</span><span class="p">(</span><span class="n">num</span><span class="p">){</span>
        <span class="c1">//head &lt;-&gt; tail</span>
        <span class="n">head</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">(</span><span class="s">"0"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">(</span><span class="s">"0"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">tail</span><span class="p">;</span>
        <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="o">~</span><span class="n">LRUCache</span><span class="p">(){</span>
        <span class="k">while</span><span class="p">(</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">!=</span> <span class="n">tail</span><span class="p">){</span>
            <span class="n">pop_back</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">delete</span> <span class="n">head</span><span class="p">;</span>
        <span class="k">delete</span> <span class="n">tail</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">bool</span> <span class="n">lookup</span><span class="p">(</span><span class="n">string</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">){</span>
        <span class="cm">/* find a matching item */</span>
        <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">it</span> <span class="o">==</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span> <span class="c1">//not found</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span> <span class="c1">//found</span>
        <span class="cm">/* update linked list */</span>
        <span class="n">detach</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//detach</span>
        <span class="n">push_front</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//add to the head because this is the latest</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">put</span><span class="p">(</span><span class="n">string</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">){</span>
        <span class="cm">/* find a matching item: O(1) operation */</span>
        <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span> <span class="c1">//found</span>
            <span class="cm">/* update data */</span>
            <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
            <span class="cm">/* update linked list */</span>
            <span class="n">detach</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//detach</span>
            <span class="n">push_front</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//add to the head because this is the latest</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="cm">/* Add new one: O(1) operation */</span>
        <span class="k">if</span><span class="p">(</span><span class="n">CacheEntries</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">MaxNumEntries</span><span class="p">){</span> <span class="c1">//Cache is NOT full</span>
            <span class="n">Item</span> <span class="o">*</span><span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
            <span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">Item</span> <span class="o">*&gt;</span> <span class="n">entry</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
            <span class="n">CacheEntries</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
            <span class="n">push_front</span><span class="p">(</span><span class="n">t</span><span class="p">);</span> <span class="c1">//Latest one</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">//Cache is full</span>
            <span class="cm">/* Select Victim &amp; delete */</span>
            <span class="n">string</span> <span class="n">key</span><span class="p">;</span>
            <span class="n">back</span><span class="p">(</span><span class="n">key</span><span class="p">);</span> <span class="c1">//get the key of the oldest one</span>
            <span class="n">pop_back</span><span class="p">();</span>       <span class="c1">//remove the oldest one</span>
            <span class="k">auto</span> <span class="n">rt</span> <span class="o">=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">rt</span> <span class="o">!=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span> <span class="c1">//found</span>
                <span class="n">CacheEntries</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span> <span class="c1">//delete</span>
            <span class="p">}</span>
            <span class="n">Item</span> <span class="o">*</span><span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
            <span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">Item</span> <span class="o">*&gt;</span> <span class="n">entry</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
            <span class="n">CacheEntries</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
            <span class="n">push_front</span><span class="p">(</span><span class="n">t</span><span class="p">);</span> <span class="c1">//Latest one</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">LRUCache</span> <span class="n">cache</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"B"</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"C"</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"D"</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"E"</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">cache</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="n">val</span><span class="p">)){</span> <span class="c1">//'A' is updated. So 'B' becomes the oldest.</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"A's value is "</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//expected result</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"A: Not found"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"F"</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="c1">//Cache replacement. 'B' is removed and 'C' becomes the oldest</span>
    <span class="k">if</span><span class="p">(</span><span class="n">cache</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">"B"</span><span class="p">,</span> <span class="n">val</span><span class="p">)){</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"B's value is "</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"B: Not found"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//expected</span>
    <span class="p">}</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"C"</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span> <span class="c1">//'C' is updated. Now 'D' becomes the oldest</span>
    <span class="k">if</span><span class="p">(</span><span class="n">cache</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">"C"</span><span class="p">,</span> <span class="n">val</span><span class="p">)){</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"C's value is "</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//expected</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"C: Not found"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"G"</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span> <span class="c1">//Cache replacement. 'D' is removed and 'E' becomes the oldest</span>
    <span class="k">if</span><span class="p">(</span><span class="n">cache</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">"D"</span><span class="p">,</span> <span class="n">val</span><span class="p">)){</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"D's value is "</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"D: Not found"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//expected result</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="template"> <a href="#template" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> template </h3> <p>template을 이용해 입력 type을 컴파일 타임에 결정하게 한 코드는 다음과 같다.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;iostream&gt;
#include &lt;unordered_map&gt;
#include &lt;string&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">K</span><span class="p">,</span> <span class="k">class</span> <span class="nc">V</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">Item</span> <span class="p">{</span>
    <span class="n">K</span> <span class="n">key</span><span class="p">;</span>
    <span class="n">V</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">Item</span> <span class="o">*</span><span class="n">prev</span><span class="p">;</span>
    <span class="n">Item</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="n">Item</span><span class="p">(</span><span class="n">string</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="o">:</span> <span class="n">key</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">value</span><span class="p">(</span><span class="n">v</span><span class="p">){</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">K</span><span class="p">,</span> <span class="k">class</span> <span class="nc">V</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Cache</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">lookup</span><span class="p">(</span><span class="n">K</span> <span class="n">key</span><span class="p">,</span> <span class="n">V</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">put</span><span class="p">(</span><span class="n">K</span> <span class="n">key</span><span class="p">,</span> <span class="n">V</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">K</span><span class="p">,</span> <span class="k">class</span> <span class="nc">V</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">LRUCache</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Cache</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="cm">/* Doubly Linked List: Head - The most recent, Tail - The least recent */</span>
    <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">head</span><span class="p">;</span>
    <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">tail</span><span class="p">;</span>
    <span class="kt">void</span> <span class="n">detach</span><span class="p">(</span><span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">item</span><span class="p">){</span> <span class="c1">//Detach item from linked list : O(1)</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kt">void</span> <span class="n">push_front</span><span class="p">(</span><span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">item</span><span class="p">){</span> <span class="c1">//Add the new item at the front : O(1)</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">item</span><span class="p">;</span>
        <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">item</span><span class="p">;</span>
        <span class="n">item</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kt">void</span> <span class="n">pop_back</span><span class="p">(){</span> <span class="c1">//delete item from the tail : O(1)</span>
        <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="o">!=</span> <span class="n">head</span><span class="p">){</span>
            <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
            <span class="k">delete</span> <span class="n">item</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">tail</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kt">bool</span> <span class="n">back</span><span class="p">(</span><span class="n">K</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">){</span> <span class="c1">//Get the item from the tail: O(1)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">==</span> <span class="n">head</span><span class="p">){</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="cm">/* Hash Table */</span>
    <span class="kt">int</span> <span class="n">MaxNumEntries</span><span class="p">;</span>
    <span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;*&gt;</span> <span class="n">CacheEntries</span><span class="p">;</span>
<span class="nl">public:</span>
    <span class="n">LRUCache</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="o">:</span><span class="n">MaxNumEntries</span><span class="p">(</span><span class="n">num</span><span class="p">){</span>
        <span class="c1">//head &lt;-&gt; tail</span>
        <span class="n">head</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"0"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"0"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">tail</span><span class="p">;</span>
        <span class="n">tail</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="o">~</span><span class="n">LRUCache</span><span class="p">(){</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">!=</span> <span class="n">tail</span><span class="p">){</span>
            <span class="n">pop_back</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">delete</span> <span class="n">head</span><span class="p">;</span>
        <span class="k">delete</span> <span class="n">tail</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">bool</span> <span class="n">lookup</span><span class="p">(</span><span class="n">K</span> <span class="n">k</span><span class="p">,</span> <span class="n">V</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">){</span>
        <span class="cm">/* find a matching item */</span>
        <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">==</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span> <span class="c1">//not found</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span> <span class="c1">//found</span>
        <span class="cm">/* update linked list */</span>
        <span class="n">detach</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//detach</span>
        <span class="n">push_front</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//add to the head because this is the latest</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">put</span><span class="p">(</span><span class="n">K</span> <span class="n">k</span><span class="p">,</span> <span class="n">V</span> <span class="n">val</span><span class="p">){</span>
        <span class="cm">/* find a matching item: O(1) operation */</span>
        <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span> <span class="c1">//found</span>
            <span class="cm">/* update data */</span>
            <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
            <span class="cm">/* update linked list */</span>
            <span class="n">detach</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//detach</span>
            <span class="n">push_front</span><span class="p">((</span><span class="o">*</span><span class="n">it</span><span class="p">).</span><span class="n">second</span><span class="p">);</span> <span class="c1">//add to the head because this is the latest</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="cm">/* Add new one: O(1) operation */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">CacheEntries</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">MaxNumEntries</span><span class="p">){</span> <span class="c1">//Cache is NOT full</span>
            <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
            <span class="n">pair</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">*&gt;</span> <span class="n">entry</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
            <span class="n">CacheEntries</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
            <span class="n">push_front</span><span class="p">(</span><span class="n">t</span><span class="p">);</span> <span class="c1">//Latest one</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span> <span class="c1">//Cache is full</span>
            <span class="cm">/* Select Victim &amp; delete */</span>
            <span class="n">K</span> <span class="n">key</span><span class="p">;</span>
            <span class="n">back</span><span class="p">(</span><span class="n">key</span><span class="p">);</span> <span class="c1">//get the key of the oldest one</span>
            <span class="n">pop_back</span><span class="p">();</span>       <span class="c1">//remove the oldest one</span>
            <span class="k">auto</span> <span class="n">rt</span> <span class="o">=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">rt</span> <span class="o">!=</span> <span class="n">CacheEntries</span><span class="p">.</span><span class="n">end</span><span class="p">()){</span> <span class="c1">//found</span>
                <span class="n">CacheEntries</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span> <span class="c1">//delete</span>
            <span class="p">}</span>
            <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
            <span class="n">pair</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">Item</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">*&gt;</span> <span class="n">entry</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
            <span class="n">CacheEntries</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>
            <span class="n">push_front</span><span class="p">(</span><span class="n">t</span><span class="p">);</span> <span class="c1">//Latest one</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">LRUCache</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">cache</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"B"</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"C"</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"D"</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"E"</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cache</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="n">val</span><span class="p">)){</span> <span class="c1">//'A' is updated. So 'B' becomes the oldest.</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"A's value is "</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//expected result</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"A: Not found"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"F"</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="c1">//Cache replacement. 'B' is removed and 'C' becomes the oldest</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cache</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">"B"</span><span class="p">,</span> <span class="n">val</span><span class="p">)){</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"B's value is "</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"B: Not found"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//expected</span>
    <span class="p">}</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"C"</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span> <span class="c1">//'C' is updated. Now 'D' becomes the oldest</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cache</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">"C"</span><span class="p">,</span> <span class="n">val</span><span class="p">)){</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"C's value is "</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//expected</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"C: Not found"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"G"</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span> <span class="c1">//Cache replacement. 'D' is removed and 'E' becomes the oldest</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cache</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">"D"</span><span class="p">,</span> <span class="n">val</span><span class="p">)){</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"D's value is "</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"D: Not found"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">//expected result</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> </div> </div> </div> </div> </body> </html>
