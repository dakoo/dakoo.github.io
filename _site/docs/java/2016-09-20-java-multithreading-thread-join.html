<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Java - (멀티쓰레딩 9) 쓰레드 Join하기 - Clean Code</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Java - (멀티쓰레딩 9) 쓰레드 Join하기 | Clean Code</title> <meta name="generator" content="Jekyll v3.8.6" /> <meta property="og:title" content="Java - (멀티쓰레딩 9) 쓰레드 Join하기" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Clean Code" /> <meta property="og:description" content="Clean Code" /> <link rel="canonical" href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-join.html" /> <meta property="og:url" content="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-join.html" /> <meta property="og:site_name" content="Clean Code" /> <script type="application/ld+json"> {"description":"Clean Code","@type":"WebPage","url":"http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-join.html","headline":"Java - (멀티쓰레딩 9) 쓰레드 Join하기","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000" class="site-title lh-tight">Clean Code</a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="http://localhost:4000/404.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="http://localhost:4000/" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/codingInterview" class="navigation-list-link">Coding Interview</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2018-07-28-algorithm-sliding-window.html" class="navigation-list-link">Algorithm - sliding window algorithm</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-dijkstra-algorithm.html" class="navigation-list-link">Algorithm - Dijkstra's shortest path</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-disjoints-set.html" class="navigation-list-link">Data Structure - disjoints-set</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-priority-queue.html" class="navigation-list-link">Data Structure - Priority Queue</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-07-mst-kruskal.html" class="navigation-list-link">Algorithm - Minimum Spanning Tree - Kruskal</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-11-string-pattern-search.html" class="navigation-list-link">Algorithm - 문자열 패턴 검색 보이어-무어 알고리즘에 대한 이해와 구현</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-12-substring-sorting.html" class="navigation-list-link">Algorithm - 부분 문자열의 사전순 정렬</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-14-Longest%20Increasing%20Subsequence.html" class="navigation-list-link">Algorithm - LIS(Longest Increasing Subsequence) O(N*N) 알고리즘</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-14-floyd-warshall.html" class="navigation-list-link">Algorithm - Floyd-Warshall</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-14-probability_summary.html" class="navigation-list-link">Algorithm - 확률에 대한 간단 정리</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-01knapsack.html" class="navigation-list-link">Algorithm - 0-1 Knapsack 알고리즘</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-longest-common-subsequence.html" class="navigation-list-link">Algorithm - LCS(Longest Common Subsequence) 알고리즘</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-permutation-composition-summary.html" class="navigation-list-link">Algorithm - 순열과 조합</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-travelling-salesman-problem.html" class="navigation-list-link">Algorithm - Travelling Salesman Problem(TSP)</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-16-independent_probability_problem.html" class="navigation-list-link">Algorithm - 독립 시행 확률</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-27-combination-in-c.html" class="navigation-list-link">Algorithm - combination</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-05-algorithm-quicksort.html" class="navigation-list-link">Algorithm - quick sort</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-09-algorithm-bisectional-search.html" class="navigation-list-link">Algorithm - 이분 탐색</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-09-algorithm-longest-increasing-subsequence-nlogn.html" class="navigation-list-link">Algorithm - Longest Increasing Subsequence</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-09-algorithm-maximum-sum-subarray.html" class="navigation-list-link">Algorithm - maximum sum subarray</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-13-data-structure-hash-table.html" class="navigation-list-link">Data Structure - hash table</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-14-data-structure-binary-search-tree.html" class="navigation-list-link">Data Structure - binary search tree</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-15-data-structure-binary-tree-problems.html" class="navigation-list-link">Algorithm - binary tree 및 binary search tree 문제들</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-22-algorithm-find-kth-item.html" class="navigation-list-link">Algorithm - k번째 큰(작은) 아이템 찾기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-22-algorithm-merge-sort.html" class="navigation-list-link">Algorithm - merge sort</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-25-algorithm-topological-sort.html" class="navigation-list-link">Algorithm - Topological Sort</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-29-data-structure-LRU-cache.html" class="navigation-list-link">Data Structure - LRU(Least Recently Used)</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-03-01-algorithm-2d-matrix-rotation.html" class="navigation-list-link">Algorithm - 2D Matrix 회전</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-03-03-data-structure-b-tree.html" class="navigation-list-link">Data Structure - B-tree</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-algorithm-dfs-bfs.html" class="navigation-list-link">Algorithm - DFS와 BFS</a></li></ul></li><li class="navigation-list-item active"><a href="http://localhost:4000/docs/java" class="navigation-list-link">Java</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-11-27-java-intellij-shortcut.html" class="navigation-list-link">Java - OSX에서 vim 모드와 함께 쓸 만한 Intellij 단축키</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-23-java-collections-api.html" class="navigation-list-link">Java - Collections API</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-23-java-comparable-comparator.html" class="navigation-list-link">Java - Comparable과 Comparator</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-23-java-lambda.html" class="navigation-list-link">Java - Lambda</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-29-java-collection-framework.html" class="navigation-list-link">Java - Collection Framework</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-30-java-collection-list.html" class="navigation-list-link">Java - List 인터페이스</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-31-java-arraylist.html" class="navigation-list-link">Java - ArrayList 클래스</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-31-java-linkedlist.html" class="navigation-list-link">Java - LinkedList 클래스</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-04-java-stream.html" class="navigation-list-link">Java - Stream</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-06-java-stringbuilder.html" class="navigation-list-link">Java - StringBuilder</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-12-java-comparator-interface.html" class="navigation-list-link">Java - Comparator Interface 사용</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-12-java-generic-function.html" class="navigation-list-link">Java - Generic function</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-13-java-bitset.html" class="navigation-list-link">Java - BitSet class 예제</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-13-java-priority-queue.html" class="navigation-list-link">Java - Priority Queue</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-15-java-multithreading-thread-thread-implementation.html" class="navigation-list-link">Java - (멀티쓰레딩 1) Thread 구현</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-16-java-multithreading-executor-basic.html" class="navigation-list-link">Java - (멀티쓰레딩 2) Executor 기본</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-16-java-vararg-stream-conversion.html" class="navigation-list-link">Java - vararg을 stream으로 변환</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-17-java-annotation.html" class="navigation-list-link">Java - Annotation</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-17-java-name-threads.html" class="navigation-list-link">Java - (멀티쓰레딩 3) 쓰레드 이름 설정</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-18-java-mulitthreading-daemon-thread.html" class="navigation-list-link">Java - (멀티쓰레딩 5) 데몬 쓰레드</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-18-java-multithreading-returning-values-from-task.html" class="navigation-list-link">Java - (멀티쓰레딩 4) 쓰레드에서 값 반환</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-19-java-multithreading-check-aliveness.html" class="navigation-list-link">Java - (멀티쓰레딩 6) 쓰레드 동작의 완료를 확인하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-exception-handling.html" class="navigation-list-link">Java - (멀티쓰레딩 8) 쓰레드 Exception 처리하기</a></li><li class="navigation-list-item active"><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-join.html" class="navigation-list-link active">Java - (멀티쓰레딩 9) 쓰레드 Join하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-scheduling.html" class="navigation-list-link">Java - (멀티쓰레딩 10) 쓰레드 스케쥴링</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-termination.html" class="navigation-list-link">Java - (멀티쓰레딩 7) 쓰레드 중지하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-10-02-java-naming.html" class="navigation-list-link">Java - 네이밍</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-10-12-java-final-keyword.html" class="navigation-list-link">Java - final 키워드</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-10-14-java-lombok.html" class="navigation-list-link">Java - Lombok</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-22-java-big-number.html" class="navigation-list-link">Java - Big Number(BigInteger와 BigDecimal)</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/javascript" class="navigation-list-link">Javascript</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/javascript/2015-08-24-everything-about-javascript-scope.html" class="navigation-list-link">Javascript - scope에 대해 알고자 했던 모든 것</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/javascript/2018-02-22-javascript-best-deepcopy.html" class="navigation-list-link">Javascript - deep copy가 필요할 때 무얼 사용해야 할까?</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/systemDesignInterview" class="navigation-list-link">System Design Interview</a><ul class="navigation-list-child-list "></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/tool" class="navigation-list-link">Tool</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-tool-notification-after-job-finish-mac-terminal.html" class="navigation-list-link">Tool - Mac에서 터미널 작업 실행후 notification</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-10-04-git-pull-request.html" class="navigation-list-link">Git - pull request</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-10-05-git-revert-changes.html" class="navigation-list-link">Git - 수정한 것 되돌리기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-11-03-bash-find-pattern-in-directories.html" class="navigation-list-link">shell - 폴더에서 파일 내용 검색하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-11-07-git-diff.html" class="navigation-list-link">Git - diff 사용하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-11-08-how-to-patch.html" class="navigation-list-link">Tool - patch하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-12-30-tool-grep-remove-useless-lines.html" class="navigation-list-link">grep 명령 - 빈 줄이나 특정 줄 제거하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-12-30-tool-sed-replace-string.html" class="navigation-list-link">sed 명령 - 특정 문자열을 변경하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-12-30-tool-sort-reverse-order.html" class="navigation-list-link">sort 명령 - 크기 역순으로 정렬하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2017-01-07-linux-useful-bash-commands.html" class="navigation-list-link">유용한 bash 명령들</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2017-03-13-uml-plantuml.html" class="navigation-list-link">uml - plantuml</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-quick-directory-alias.html" class="navigation-list-link">Tool - Quick directory alias</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-run-command-in-new-terminal-tab.html" class="navigation-list-link">Tool - Mac iterm2에서 작업을 다른 tab에서 실행하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-run-ssh-in-new-terminal-tab.html" class="navigation-list-link">Tool - Mac iterm2에서 ssh를 다른 tab에서 실행하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2015-07-21-uml-tools.html" class="navigation-list-link">Design - 좋은 UML 툴 추천</a></li></ul></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Clean Code" aria-label="Search Clean Code" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> </div> <div class="page"> <nav class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/java">Java</a></li> <li class="breadcrumb-nav-list-item"><span>Java - (멀티쓰레딩 9) 쓰레드 Join하기</span></li> </ol> </nav> <div id="main-content" class="page-content" role="main"> <h2 id="1-일반-쓰레드가-다른-쓰레드가-끝날때까지-대기하게-하기"> <a href="#1-일반-쓰레드가-다른-쓰레드가-끝날때까지-대기하게-하기" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1 일반 쓰레드가 다른 쓰레드가 끝날때까지 대기하게 하기 </h2> <h4 id="11-이전에-살펴본-방식"> <a href="#11-이전에-살펴본-방식" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1.1 이전에 살펴본 방식 </h4> <p>쓰레드가 다른 쓰레드가 종료될 때까지 대기하는 방법은 이미 두 가지를 다루었다.</p> <ul> <li><a href="http://hochulshin.com/java-multithreading-check-aliveness/">(멀티쓰레딩 6) 쓰레드 동작의 완료를 확인하기</a>에서 다룬 <code class="highlighter-rouge">Thread.isAlive()</code>를 사용하여 계속 확인을 하는 것이다.</li> <li><a href="http://hochulshin.com/java-multithreading-returning-values-from-task/">(멀티쓰레딩 4) 쓰레드에서 값 반환</a>에서 다룬 <code class="highlighter-rouge">synchronized</code>에서 wait()와 notify()를 사용하는 블록킹 방식이다.</li> </ul> <p>첫번째 폴링하는 방법은 CPU의 낭비가 심하고 두번째 블록킹 방법은 제대로 구현하기 어렵다.</p> <h3 id="12-join을-사용해서-다른-쓰레드-종료를-기다리기"> <a href="#12-join을-사용해서-다른-쓰레드-종료를-기다리기" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1.2 join()을 사용해서 다른 쓰레드 종료를 기다리기 </h3> <p>세번째 방법이 <code class="highlighter-rouge">Thread.join()</code> 메소드를 사용하는 것이다.</p> <blockquote> <p>void Thread.join()</p> </blockquote> <p>이 메소드는 wait()와 notify()처럼 동작을 하지만 사용하기가 상대적으로 편하다. 이미 대기하는 쓰레드가 종류한 경우에는 join()을 호출함과 동시에 리턴된다.</p> <p>예제는 아래와 같다. thread1, 2, 3가 실행이 되는데 thread3이 가장 먼저 끝나고, thread1이 다음, 마지막으로 thread2가 종료되도록 되어 있다. 하지만, join()을 호출하는 순서가 thread1, 2, 3이므로 main thread는 thread1을 join한 뒤에야 thread2를 join하고 마지막으로 thread3를 join한다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JoiningThreads</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argc</span><span class="o">[])</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="s">" thread starts here..."</span><span class="o">);</span>

		<span class="nc">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoopTask</span><span class="o">(</span><span class="mi">200</span><span class="o">),</span> <span class="s">"Thread-1"</span><span class="o">);</span>
		<span class="nc">Thread</span> <span class="n">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoopTask</span><span class="o">(</span><span class="mi">500</span><span class="o">),</span> <span class="s">"Thread-2"</span><span class="o">);</span>
		<span class="nc">Thread</span> <span class="n">thread3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoopTask</span><span class="o">(</span><span class="mi">100</span><span class="o">),</span> <span class="s">"Thread-3"</span><span class="o">);</span>

		<span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
		<span class="n">thread2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
		<span class="n">thread3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
		
		<span class="n">thread1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="s">" joined "</span> <span class="o">+</span> <span class="n">thread1</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
		
		<span class="n">thread2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="s">" joined "</span> <span class="o">+</span> <span class="n">thread2</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
		
		<span class="n">thread3</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="s">" joined "</span> <span class="o">+</span> <span class="n">thread3</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="s">" thread ends here..."</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">LoopTask</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">sleepTime</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">taskId</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span> 
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> <span class="o">+</span> <span class="s">"&gt; starting...####"</span><span class="o">);</span>
		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> <span class="o">+</span> <span class="s">"&gt; TICK TICK"</span><span class="o">);</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">sleepTime</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> <span class="o">+</span> <span class="s">"&gt; done...####"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">LoopTask</span><span class="o">(</span><span class="kt">long</span> <span class="n">sleepTime</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="o">++</span><span class="n">count</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">taskId</span> <span class="o">=</span> <span class="s">"Task-"</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">sleepTime</span> <span class="o">=</span> <span class="n">sleepTime</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>결과도 예상한 바와 마찬가지이다. thread내부에서 done이 출력한 순서는 3, 1, 2이지만, join이 출력된 순서는 1, 2, 3이다.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[main] thread starts here...
#### &lt;Thread-1,Task-1&gt; starting...####
&lt;Thread-1,Task-1&gt; TICK TICK
#### &lt;Thread-3,Task-3&gt; starting...####
#### &lt;Thread-2,Task-2&gt; starting...####
&lt;Thread-2,Task-2&gt; TICK TICK
&lt;Thread-3,Task-3&gt; TICK TICK
&lt;Thread-3,Task-3&gt; TICK TICK
&lt;Thread-1,Task-1&gt; TICK TICK
&lt;Thread-3,Task-3&gt; TICK TICK
&lt;Thread-3,Task-3&gt; TICK TICK
&lt;Thread-1,Task-1&gt; TICK TICK
#### &lt;Thread-3,Task-3&gt; done...####
&lt;Thread-2,Task-2&gt; TICK TICK
&lt;Thread-1,Task-1&gt; TICK TICK
#### &lt;Thread-1,Task-1&gt; done...####
[main] joined Thread-1
&lt;Thread-2,Task-2&gt; TICK TICK
&lt;Thread-2,Task-2&gt; TICK TICK
#### &lt;Thread-2,Task-2&gt; done...####
[main] joined Thread-2
[main] joined Thread-3
[main] thread ends here...
</code></pre></div></div> <h3 id="13-join을-사용해서-일반-쓰레드에서-값-반환하기"> <a href="#13-join을-사용해서-일반-쓰레드에서-값-반환하기" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1.3 join()을 사용해서 일반 쓰레드에서 값 반환하기 </h3> <p>일반 쓰레드에서 값을 반환하는 방법은 이미 <a href="http://hochulshin.com/java-multithreading-returning-values-from-task/">(멀티쓰레딩 4) 쓰레드에서 값 반환</a>에서 다루었다. 그 글에서는 <code class="highlighter-rouge">synchronized</code>의 wait()와 notify()를 사용했다. 그런데 위에서 언급한 바와 같이 join()은 마치 wait()와 notify()처럼 동작한다. 이런 join()의 동작을 이용하여 일반 쓰레드에서 값을 반환하는 것을 구현해 보자. <a href="http://hochulshin.com/java-multithreading-returning-values-from-task/">(멀티쓰레딩 4) 쓰레드에서 값 반환</a>에서는 boolean 변수인 done과 synchronized {}를 사용했는데 join을 사용하면 그럴 필요가 없다. 단지, join()을 한 후에 get() 메소드를 이용해 결과값을 읽어오면 되는 것이다. 그것은 쓰레드는 종료되었지만, 태스크 객체는 남아있기 때문에 가능한 것이다. <a href="http://hochulshin.com/java-multithreading-returning-values-from-task/">(멀티쓰레딩 4) 쓰레드에서 값 반환</a>에서 사용한 예제를 수정한 예제는 다음과 같다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReturningValueFromThreads</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argc</span><span class="o">[])</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread starts here..."</span><span class="o">);</span>

		<span class="nc">MyThreadTask</span> <span class="n">task1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThreadTask</span><span class="o">();</span>
		<span class="nc">MyThreadTask</span> <span class="n">task2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThreadTask</span><span class="o">();</span>
		<span class="nc">MyThreadTask</span> <span class="n">task3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThreadTask</span><span class="o">();</span>

		<span class="nc">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">task1</span><span class="o">,</span><span class="s">"firstThread"</span><span class="o">);</span>
		<span class="nc">Thread</span> <span class="n">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">task2</span><span class="o">,</span><span class="s">"secondThread"</span><span class="o">);</span>
		<span class="nc">Thread</span> <span class="n">thread3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">task3</span><span class="o">,</span><span class="s">"thirdThread"</span><span class="o">);</span>
		<span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
		<span class="n">thread2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
		<span class="n">thread3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
		
		<span class="n">thread1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"task1 result:"</span> <span class="o">+</span> <span class="n">task1</span><span class="o">.</span><span class="na">getRandomSum</span><span class="o">());</span>
		<span class="n">thread2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"task2 result:"</span> <span class="o">+</span> <span class="n">task2</span><span class="o">.</span><span class="na">getRandomSum</span><span class="o">());</span>
		<span class="n">thread3</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"task3 result:"</span> <span class="o">+</span> <span class="n">task3</span><span class="o">.</span><span class="na">getRandomSum</span><span class="o">());</span>
		
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread ends here..."</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">MyThreadTask</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">randomSum</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;"</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">"&gt;TICK TICK "</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
			<span class="n">randomSum</span> <span class="o">+=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="mi">1000</span><span class="o">;</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MICROSECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getRandomSum</span><span class="o">(){</span>
		<span class="k">return</span> <span class="n">randomSum</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">MyThreadTask</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="o">++</span><span class="n">count</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>결과도 예상한 바와 마찬가지이다.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Main thread starts here...
&lt;1&gt;TICK TICK 0
&lt;2&gt;TICK TICK 0
&lt;3&gt;TICK TICK 0
&lt;2&gt;TICK TICK 1
&lt;3&gt;TICK TICK 1
&lt;1&gt;TICK TICK 1
&lt;2&gt;TICK TICK 2
&lt;1&gt;TICK TICK 2
&lt;3&gt;TICK TICK 2
&lt;2&gt;TICK TICK 3
&lt;1&gt;TICK TICK 3
&lt;3&gt;TICK TICK 3
&lt;2&gt;TICK TICK 4
&lt;1&gt;TICK TICK 4
&lt;3&gt;TICK TICK 4
task1 result:3033
task2 result:2059
task3 result:3800
Main thread ends here...
</code></pre></div></div> <h2 id="2-executor-태스크가-종료-될때까지-대기하기"> <a href="#2-executor-태스크가-종료-될때까지-대기하기" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 2 Executor 태스크가 종료 될때까지 대기하기 </h2> <p>다른 Executor 태스크가 끝날때까지 한 태스크를 정지해 놓는 방법을 알아보자. Java는 이를 위해 <code class="highlighter-rouge">java.util.concurrent.CountDownLatch 클래스</code>를 제공한다. 일반 쓰레드는 Thread.join()하나를 사용할 뿐이지만, Executor는 클래스를 사용해야 한다. CountDownLatch object는 종료할 태스크들과 그 태스크들이 종료하길 기다리는 태스크들이 모두 공유한다. 몇 개의 태스크들이 종료해야 하는 지를 0보다 큰 숫자로 정해놓고 하나씩 줄여나가면서 기다리는 방식이다.</p> <ul> <li>대기하는 태스크: <code class="highlighter-rouge">void await()</code> 메소드를 호출하여 count가 0이 될때까지 블록되어 기다린다.</li> <li>종료하는 태스크: <code class="highlighter-rouge">void coutndown()</code> 메소드를 실행이 끝난후에 호출한다. 이러면 count가 1 감소한다.</li> </ul> <p>count가 0이 되면 대기하던 태스크들은 모두 블록킹 상태에서 풀려나서 실행을 지속하게 된다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.concurrent.CountDownLatch</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutorService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JoiningExecutors</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argc</span><span class="o">[])</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="s">" thread starts here..."</span><span class="o">);</span>

		<span class="nc">ExecutorService</span> <span class="n">execService1</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">(</span><span class="k">new</span> <span class="nc">NamedThreadsFactory</span><span class="o">());</span>
		<span class="nc">CountDownLatch</span> <span class="n">doneSignal</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountDownLatch</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span> <span class="c1">//set the initial count</span>

		<span class="n">execService1</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoopTask</span><span class="o">(</span><span class="n">doneSignal</span><span class="o">));</span>
		<span class="n">execService1</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoopTask</span><span class="o">(</span><span class="n">doneSignal</span><span class="o">));</span>
		<span class="n">execService1</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoopTask</span><span class="o">(</span><span class="n">doneSignal</span><span class="o">));</span>
		<span class="n">execService1</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoopTask</span><span class="o">(</span><span class="n">doneSignal</span><span class="o">));</span>

		<span class="n">execService1</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
		
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">doneSignal</span><span class="o">.</span><span class="na">await</span><span class="o">();</span> <span class="c1">//wait for the count = 0</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="s">" got the signal to continue..."</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="s">" thread ends here..."</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">NamedThreadsFactory</span> <span class="kd">implements</span> <span class="nc">ThreadFactory</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nc">Name</span> <span class="o">=</span> <span class="s">"MyThread-"</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Thread</span> <span class="nf">newThread</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="nc">Name</span> <span class="o">+</span> <span class="o">++</span><span class="n">count</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">LoopTask</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">taskId</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">CountDownLatch</span> <span class="n">doneCountLatch</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> <span class="o">+</span> <span class="s">"&gt; starting...####"</span><span class="o">);</span>
		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> <span class="o">+</span> <span class="s">"&gt; TICK TICK"</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">((</span><span class="kt">long</span><span class="o">)</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="mi">1000</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>		
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> <span class="o">+</span> <span class="s">"&gt; done...####"</span><span class="o">);</span>
		<span class="k">if</span><span class="o">(</span><span class="n">doneCountLatch</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">doneCountLatch</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span>	<span class="c1">//count-- </span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> <span class="o">+</span> <span class="s">"&gt; LATCH COUNT ="</span> <span class="o">+</span> <span class="n">doneCountLatch</span><span class="o">.</span><span class="na">getCount</span><span class="o">());</span>
		<span class="o">}</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="nf">LoopTask</span><span class="o">(</span><span class="nc">CountDownLatch</span> <span class="n">doneCountLatch</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="o">++</span><span class="n">count</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">taskId</span> <span class="o">=</span> <span class="s">"LoopTask"</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">doneCountLatch</span> <span class="o">=</span> <span class="n">doneCountLatch</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>결과도 예상한 바와 마찬가지이다. COUNT가 0이 된다음에야 await()를 지나가서 got the signal to continue…를 출력한다.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[main] thread starts here...
#### &lt;MyThread-1,LoopTask1&gt; starting...####
#### &lt;MyThread-2,LoopTask2&gt; starting...####
&lt;MyThread-1,LoopTask1&gt; TICK TICK0
#### &lt;MyThread-3,LoopTask3&gt; starting...####
&lt;MyThread-2,LoopTask2&gt; TICK TICK0
&lt;MyThread-3,LoopTask3&gt; TICK TICK0
#### &lt;MyThread-4,LoopTask4&gt; starting...####
&lt;MyThread-4,LoopTask4&gt; TICK TICK0
&lt;MyThread-1,LoopTask1&gt; TICK TICK1
&lt;MyThread-1,LoopTask1&gt; TICK TICK2
&lt;MyThread-2,LoopTask2&gt; TICK TICK1
&lt;MyThread-3,LoopTask3&gt; TICK TICK1
&lt;MyThread-4,LoopTask4&gt; TICK TICK1
&lt;MyThread-3,LoopTask3&gt; TICK TICK2
&lt;MyThread-3,LoopTask3&gt; TICK TICK3
&lt;MyThread-3,LoopTask3&gt; TICK TICK4
&lt;MyThread-2,LoopTask2&gt; TICK TICK2
&lt;MyThread-1,LoopTask1&gt; TICK TICK3
&lt;MyThread-1,LoopTask1&gt; TICK TICK4
#### &lt;MyThread-1,LoopTask1&gt; done...####
&lt;MyThread-2,LoopTask2&gt; TICK TICK3
&lt;MyThread-2,LoopTask2&gt; TICK TICK4
#### &lt;MyThread-2,LoopTask2&gt; done...####
#### &lt;MyThread-3,LoopTask3&gt; done...####
#### &lt;MyThread-3,LoopTask3&gt; LATCH COUNT =1
&lt;MyThread-4,LoopTask4&gt; TICK TICK2
#### &lt;MyThread-2,LoopTask2&gt; LATCH COUNT =2
#### &lt;MyThread-1,LoopTask1&gt; LATCH COUNT =3
&lt;MyThread-4,LoopTask4&gt; TICK TICK3
&lt;MyThread-4,LoopTask4&gt; TICK TICK4
#### &lt;MyThread-4,LoopTask4&gt; done...####
#### &lt;MyThread-4,LoopTask4&gt; LATCH COUNT =0
[main] got the signal to continue...
[main] thread ends here...
</code></pre></div></div> </div> </div> </div> </div> </body> </html>
