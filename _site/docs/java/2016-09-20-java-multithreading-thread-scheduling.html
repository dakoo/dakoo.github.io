<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Java - (멀티쓰레딩 10) 쓰레드 스케쥴링 - Clean Code</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Java - (멀티쓰레딩 10) 쓰레드 스케쥴링 | Clean Code</title> <meta name="generator" content="Jekyll v3.8.6" /> <meta property="og:title" content="Java - (멀티쓰레딩 10) 쓰레드 스케쥴링" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Clean Code" /> <meta property="og:description" content="Clean Code" /> <link rel="canonical" href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-scheduling.html" /> <meta property="og:url" content="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-scheduling.html" /> <meta property="og:site_name" content="Clean Code" /> <script type="application/ld+json"> {"description":"Clean Code","@type":"WebPage","url":"http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-scheduling.html","headline":"Java - (멀티쓰레딩 10) 쓰레드 스케쥴링","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000" class="site-title lh-tight">Clean Code</a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="http://localhost:4000/404.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="http://localhost:4000/" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/codingInterview" class="navigation-list-link">Coding Interview</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2018-07-28-algorithm-sliding-window.html" class="navigation-list-link">Algorithm - sliding window algorithm</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-dijkstra-algorithm.html" class="navigation-list-link">Algorithm - Dijkstra's shortest path</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-disjoints-set.html" class="navigation-list-link">Data Structure - disjoints-set</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-priority-queue.html" class="navigation-list-link">Data Structure - Priority Queue</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-07-mst-kruskal.html" class="navigation-list-link">Algorithm - Minimum Spanning Tree - Kruskal</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-11-string-pattern-search.html" class="navigation-list-link">Algorithm - 문자열 패턴 검색 보이어-무어 알고리즘에 대한 이해와 구현</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-12-substring-sorting.html" class="navigation-list-link">Algorithm - 부분 문자열의 사전순 정렬</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-14-Longest%20Increasing%20Subsequence.html" class="navigation-list-link">Algorithm - LIS(Longest Increasing Subsequence) O(N*N) 알고리즘</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-14-floyd-warshall.html" class="navigation-list-link">Algorithm - Floyd-Warshall</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-14-probability_summary.html" class="navigation-list-link">Algorithm - 확률에 대한 간단 정리</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-01knapsack.html" class="navigation-list-link">Algorithm - 0-1 Knapsack 알고리즘</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-longest-common-subsequence.html" class="navigation-list-link">Algorithm - LCS(Longest Common Subsequence) 알고리즘</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-permutation-composition-summary.html" class="navigation-list-link">Algorithm - 순열과 조합</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-15-travelling-salesman-problem.html" class="navigation-list-link">Algorithm - Travelling Salesman Problem(TSP)</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-16-independent_probability_problem.html" class="navigation-list-link">Algorithm - 독립 시행 확률</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-27-combination-in-c.html" class="navigation-list-link">Algorithm - combination</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-05-algorithm-quicksort.html" class="navigation-list-link">Algorithm - quick sort</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-09-algorithm-bisectional-search.html" class="navigation-list-link">Algorithm - 이분 탐색</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-09-algorithm-longest-increasing-subsequence-nlogn.html" class="navigation-list-link">Algorithm - Longest Increasing Subsequence</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-09-algorithm-maximum-sum-subarray.html" class="navigation-list-link">Algorithm - maximum sum subarray</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-13-data-structure-hash-table.html" class="navigation-list-link">Data Structure - hash table</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-14-data-structure-binary-search-tree.html" class="navigation-list-link">Data Structure - binary search tree</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-15-data-structure-binary-tree-problems.html" class="navigation-list-link">Algorithm - binary tree 및 binary search tree 문제들</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-22-algorithm-find-kth-item.html" class="navigation-list-link">Algorithm - k번째 큰(작은) 아이템 찾기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-22-algorithm-merge-sort.html" class="navigation-list-link">Algorithm - merge sort</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-25-algorithm-topological-sort.html" class="navigation-list-link">Algorithm - Topological Sort</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-02-29-data-structure-LRU-cache.html" class="navigation-list-link">Data Structure - LRU(Least Recently Used)</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-03-01-algorithm-2d-matrix-rotation.html" class="navigation-list-link">Algorithm - 2D Matrix 회전</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2016-03-03-data-structure-b-tree.html" class="navigation-list-link">Data Structure - B-tree</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/codingInterview/2015-08-06-algorithm-dfs-bfs.html" class="navigation-list-link">Algorithm - DFS와 BFS</a></li></ul></li><li class="navigation-list-item active"><a href="http://localhost:4000/docs/java" class="navigation-list-link">Java</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-11-27-java-intellij-shortcut.html" class="navigation-list-link">Java - OSX에서 vim 모드와 함께 쓸 만한 Intellij 단축키</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-23-java-collections-api.html" class="navigation-list-link">Java - Collections API</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-23-java-comparable-comparator.html" class="navigation-list-link">Java - Comparable과 Comparator</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-23-java-lambda.html" class="navigation-list-link">Java - Lambda</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-29-java-collection-framework.html" class="navigation-list-link">Java - Collection Framework</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-30-java-collection-list.html" class="navigation-list-link">Java - List 인터페이스</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-31-java-arraylist.html" class="navigation-list-link">Java - ArrayList 클래스</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-31-java-linkedlist.html" class="navigation-list-link">Java - LinkedList 클래스</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-04-java-stream.html" class="navigation-list-link">Java - Stream</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-06-java-stringbuilder.html" class="navigation-list-link">Java - StringBuilder</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-12-java-comparator-interface.html" class="navigation-list-link">Java - Comparator Interface 사용</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-12-java-generic-function.html" class="navigation-list-link">Java - Generic function</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-13-java-bitset.html" class="navigation-list-link">Java - BitSet class 예제</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-13-java-priority-queue.html" class="navigation-list-link">Java - Priority Queue</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-15-java-multithreading-thread-thread-implementation.html" class="navigation-list-link">Java - (멀티쓰레딩 1) Thread 구현</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-16-java-multithreading-executor-basic.html" class="navigation-list-link">Java - (멀티쓰레딩 2) Executor 기본</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-16-java-vararg-stream-conversion.html" class="navigation-list-link">Java - vararg을 stream으로 변환</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-17-java-annotation.html" class="navigation-list-link">Java - Annotation</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-17-java-name-threads.html" class="navigation-list-link">Java - (멀티쓰레딩 3) 쓰레드 이름 설정</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-18-java-mulitthreading-daemon-thread.html" class="navigation-list-link">Java - (멀티쓰레딩 5) 데몬 쓰레드</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-18-java-multithreading-returning-values-from-task.html" class="navigation-list-link">Java - (멀티쓰레딩 4) 쓰레드에서 값 반환</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-19-java-multithreading-check-aliveness.html" class="navigation-list-link">Java - (멀티쓰레딩 6) 쓰레드 동작의 완료를 확인하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-exception-handling.html" class="navigation-list-link">Java - (멀티쓰레딩 8) 쓰레드 Exception 처리하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-join.html" class="navigation-list-link">Java - (멀티쓰레딩 9) 쓰레드 Join하기</a></li><li class="navigation-list-item active"><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-scheduling.html" class="navigation-list-link active">Java - (멀티쓰레딩 10) 쓰레드 스케쥴링</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-09-20-java-multithreading-thread-termination.html" class="navigation-list-link">Java - (멀티쓰레딩 7) 쓰레드 중지하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-10-02-java-naming.html" class="navigation-list-link">Java - 네이밍</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-10-12-java-final-keyword.html" class="navigation-list-link">Java - final 키워드</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-10-14-java-lombok.html" class="navigation-list-link">Java - Lombok</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/java/2016-08-22-java-big-number.html" class="navigation-list-link">Java - Big Number(BigInteger와 BigDecimal)</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/javascript" class="navigation-list-link">Javascript</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/javascript/2015-08-24-everything-about-javascript-scope.html" class="navigation-list-link">Javascript - scope에 대해 알고자 했던 모든 것</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/javascript/2018-02-22-javascript-best-deepcopy.html" class="navigation-list-link">Javascript - deep copy가 필요할 때 무얼 사용해야 할까?</a></li></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/systemDesignInterview" class="navigation-list-link">System Design Interview</a><ul class="navigation-list-child-list "></ul></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/tool" class="navigation-list-link">Tool</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-tool-notification-after-job-finish-mac-terminal.html" class="navigation-list-link">Tool - Mac에서 터미널 작업 실행후 notification</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-10-04-git-pull-request.html" class="navigation-list-link">Git - pull request</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-10-05-git-revert-changes.html" class="navigation-list-link">Git - 수정한 것 되돌리기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-11-03-bash-find-pattern-in-directories.html" class="navigation-list-link">shell - 폴더에서 파일 내용 검색하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-11-07-git-diff.html" class="navigation-list-link">Git - diff 사용하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-11-08-how-to-patch.html" class="navigation-list-link">Tool - patch하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-12-30-tool-grep-remove-useless-lines.html" class="navigation-list-link">grep 명령 - 빈 줄이나 특정 줄 제거하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-12-30-tool-sed-replace-string.html" class="navigation-list-link">sed 명령 - 특정 문자열을 변경하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2016-12-30-tool-sort-reverse-order.html" class="navigation-list-link">sort 명령 - 크기 역순으로 정렬하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2017-01-07-linux-useful-bash-commands.html" class="navigation-list-link">유용한 bash 명령들</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2017-03-13-uml-plantuml.html" class="navigation-list-link">uml - plantuml</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-quick-directory-alias.html" class="navigation-list-link">Tool - Quick directory alias</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-run-command-in-new-terminal-tab.html" class="navigation-list-link">Tool - Mac iterm2에서 작업을 다른 tab에서 실행하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2018-11-12-run-ssh-in-new-terminal-tab.html" class="navigation-list-link">Tool - Mac iterm2에서 ssh를 다른 tab에서 실행하기</a></li><li class="navigation-list-item "><a href="http://localhost:4000/docs/tool/2015-07-21-uml-tools.html" class="navigation-list-link">Design - 좋은 UML 툴 추천</a></li></ul></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Clean Code" aria-label="Search Clean Code" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> </div> <div class="page"> <nav class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/java">Java</a></li> <li class="breadcrumb-nav-list-item"><span>Java - (멀티쓰레딩 10) 쓰레드 스케쥴링</span></li> </ol> </nav> <div id="main-content" class="page-content" role="main"> <h2 id="1-일반-쓰레드의-스케쥴링"> <a href="#1-일반-쓰레드의-스케쥴링" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1. 일반 쓰레드의 스케쥴링 </h2> <h3 id="11-개요"> <a href="#11-개요" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1.1 개요 </h3> <p>쓰레드 스케줄링을 위해 Java Thread는 두가지 API를 제공한다.</p> <ul> <li>java.util.Timer</li> <li>java.util.TimerTask</li> </ul> <h4 id="111-javautiltimer"> <a href="#111-javautiltimer" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1.1.1 java.util.Timer </h4> <p>하나의 쓰레드를 생성하며, 그 하나의 쓰레드에서 모든 태스크를 실행한다. 스케쥴링 로직을 가지고 있어서 다음 태스크를 언제 실행할지 결정하는 API이다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span> <span class="kt">void</span> <span class="nf">schedule</span><span class="o">(</span><span class="nc">TimerTask</span> <span class="n">task</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">time</span><span class="o">)</span> <span class="o">:</span> <span class="err">정해진</span> <span class="n">time</span><span class="err">에</span> <span class="err">한번</span> <span class="err">실행</span>
<span class="o">-</span> <span class="kt">void</span> <span class="nf">schedule</span><span class="o">(</span><span class="nc">TimerTask</span> <span class="n">task</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delay</span><span class="o">)</span> <span class="o">:</span> <span class="err">현재부터</span> <span class="n">delay</span> <span class="n">millisec</span> <span class="err">이후</span> <span class="err">한번</span> <span class="err">실행</span>
<span class="o">-</span> <span class="kt">void</span> <span class="nf">schedule</span><span class="o">(</span><span class="nc">TimerTask</span> <span class="n">task</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">firstTime</span><span class="o">,</span> <span class="kt">long</span> <span class="n">period</span><span class="o">):</span> <span class="n">firstTime</span><span class="err">에</span> <span class="err">처음</span> <span class="err">실행하고</span> <span class="n">period</span> <span class="err">간격으로</span> <span class="err">계속</span> <span class="err">실행</span>
<span class="o">-</span> <span class="kt">void</span> <span class="nf">schedule</span><span class="o">(</span><span class="nc">TimerTask</span> <span class="n">task</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="kt">long</span> <span class="n">period</span><span class="o">):</span> <span class="err">현재부터</span> <span class="n">delay</span> <span class="n">millisec</span> <span class="err">이후</span> <span class="err">처음</span> <span class="err">실행하고</span> <span class="n">period</span> <span class="err">간격으로</span> <span class="err">계속</span> <span class="err">실행</span>
<span class="o">-</span> <span class="kt">void</span> <span class="nf">scheduleAtFixedRate</span><span class="o">(</span><span class="nc">TimerTask</span> <span class="n">task</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">firstTime</span><span class="o">,</span> <span class="kt">long</span> <span class="n">period</span><span class="o">):</span> <span class="n">firstTime</span><span class="err">에</span> <span class="err">처음</span> <span class="err">실행하고</span> <span class="n">period</span> <span class="err">간격으로</span> <span class="err">계속</span> <span class="err">고정</span> <span class="n">Rate</span><span class="err">으로</span> <span class="err">실행</span>
<span class="o">-</span> <span class="kt">void</span> <span class="nf">scheduleAtFixedRate</span><span class="o">(</span><span class="nc">TimerTask</span> <span class="n">task</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="kt">long</span> <span class="n">period</span><span class="o">):</span> <span class="err">현재부터</span> <span class="n">delay</span> <span class="n">millisec</span> <span class="err">이후</span> <span class="err">처음</span> <span class="err">실행하고</span> <span class="n">period</span> <span class="err">간격으로</span> <span class="err">계속</span> <span class="err">계속</span> <span class="err">고정</span> <span class="n">Rate</span><span class="err">으로</span> <span class="err">실행</span>
<span class="o">-</span> <span class="kt">void</span> <span class="nf">cancel</span><span class="o">():</span> <span class="n">Timer</span><span class="err">를</span> <span class="n">terminate</span><span class="o">.</span> <span class="o">**</span><span class="err">실행되고</span> <span class="err">있던</span> <span class="err">태스크는</span> <span class="err">계속</span> <span class="err">실행</span><span class="o">**</span> <span class="err">되며</span><span class="o">,</span> <span class="err">더이상</span> <span class="err">스케줄은</span> <span class="err">되지</span> <span class="err">않음</span>


<span class="o">.</span><span class="na">TimerTask</span> <span class="nl">task:</span> <span class="err">실행될</span> <span class="err">태스크</span>
<span class="o">.</span><span class="na">Date</span> <span class="nl">time:</span> <span class="err">실행</span> <span class="err">사작할</span> <span class="err">절대</span> <span class="err">시간</span>
<span class="o">.</span><span class="na">long</span> <span class="nl">delay:</span> <span class="err">현재</span> <span class="err">시간으로부터의</span> <span class="n">delay</span> <span class="n">offset</span><span class="o">.</span> <span class="nc">Milliseconds</span>
<span class="o">.</span><span class="na">long</span> <span class="nl">period:</span> <span class="err">태스크</span> <span class="err">실행시간</span> <span class="err">간의</span> <span class="err">고정</span> <span class="n">delay</span>


<span class="err">####</span> <span class="mf">1.1</span><span class="o">.</span><span class="mi">2</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">TimerTask</span>

<span class="err">스케줄링</span> <span class="err">대상이</span> <span class="err">되는</span> <span class="err">태스크</span> <span class="n">API</span><span class="err">이다</span><span class="o">.</span> 

<span class="nc">Runnable</span> <span class="err">인터페이스를</span> <span class="err">구현한</span> <span class="err">것이다</span><span class="o">.</span> <span class="err">반복된</span> <span class="err">실행을</span> <span class="err">위해</span> <span class="err">짧게</span> <span class="err">수행</span><span class="o">(</span><span class="kt">short</span><span class="o">-</span><span class="n">lived</span><span class="o">)</span><span class="err">되어져야</span> <span class="err">한다</span><span class="o">.</span> 

<span class="err">```</span><span class="n">java</span>
<span class="kt">long</span> <span class="nf">scheduleExecutionTime</span><span class="o">():</span> <span class="err">동작하는</span> <span class="err">시간으로</span> <span class="err">가장</span> <span class="err">최신에</span> <span class="err">실행된</span> <span class="err">시간을</span> <span class="err">반환한다</span><span class="o">.</span> 
<span class="kt">boolean</span> <span class="nf">cancel</span><span class="o">():</span> <span class="err">태스크를</span> <span class="err">취소한다</span><span class="o">.</span> <span class="err">만약</span> <span class="err">태스크가</span> <span class="err">구동중이면</span> <span class="err">구동은</span> <span class="err">지속되지만</span> <span class="err">다시</span> <span class="err">실행되지</span> <span class="err">않는다</span><span class="o">.</span> 
</code></pre></div></div> <h4 id="113-정리"> <a href="#113-정리" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1.1.3 정리 </h4> <ul> <li>Timer 객체당 한번에 하나의 태스크만 실행된다.</li> <li>Timer 태스크는 재빨리 종료되어야 한다.</li> <li>Application이 종료될 때 반드시 Timer.cancel()이 호출되어야 한다. 그렇지 않으면 leakage가 발생한다.</li> <li>Timer가 cancel되면 더이상 태스크는 스케줄되지 않는다.</li> <li>Timer 클래스는 thread-safe이다.</li> <li>Timer 클래스는 실시간성을 보장하지 않는다.</li> </ul> <h3 id="12-한번-실행되는-태스크-스케줄링하기"> <a href="#12-한번-실행되는-태스크-스케줄링하기" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1.2 한번 실행되는 태스크 스케줄링하기 </h3> <p>다음 두 메소드를 이용해서 태스크를 한번 스케줄링 할 수 있다.</p> <ul> <li>void schedule(TimerTask task, Date time) : 정해진 time에 한번 실행</li> <li>void schedule(TimerTask task, long delay) : 현재부터 delay millisec 이후 한번 실행</li> </ul> <p>예제는 다음과 같다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Calendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.GregorianCalendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Timer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.TimerTask</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SchedulingTasksForOneTimeExecution</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">SimpleDateFormat</span> <span class="n">dateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"dd-MM-yyyy HH:mm:ss.SSS"</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argc</span><span class="o">[])</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread starts here..."</span><span class="o">);</span>
	
		<span class="nc">Timer</span> <span class="n">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Timer</span><span class="o">(</span><span class="s">"Timer-thread"</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span> <span class="c1">//false: user thread, true: daemon</span>
		<span class="nc">Date</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">currentThreadName</span><span class="o">+</span><span class="s">"] Current time"</span> <span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">currentTime</span><span class="o">));</span>
		

		<span class="nc">Date</span> <span class="n">scheduledTime</span> <span class="o">=</span> <span class="nc">TimeUtils</span><span class="o">.</span><span class="na">getFutureTime</span><span class="o">(</span><span class="n">currentTime</span><span class="o">,</span> <span class="mi">5000</span><span class="o">);</span>
		<span class="nc">ScheduledTask</span> <span class="n">task0</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScheduledTask</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
		<span class="n">timer</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">task0</span><span class="o">,</span> <span class="n">scheduledTime</span><span class="o">);</span> <span class="c1">//schedule(TimerTask task, Date time)</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">currentThreadName</span><span class="o">+</span><span class="s">"] Task-0 is scheduled for running at "</span> <span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">currentTime</span><span class="o">));</span>
		
		<span class="kt">long</span> <span class="n">delayMillis</span> <span class="o">=</span> <span class="mi">10000</span><span class="o">;</span>
		<span class="nc">ScheduledTask</span> <span class="n">task1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScheduledTask</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
		<span class="n">timer</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">task1</span><span class="o">,</span> <span class="n">delayMillis</span><span class="o">);</span> <span class="c1">//schedule(TimerTask task, long delay)</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">currentThreadName</span><span class="o">+</span><span class="s">"] Task-1 is scheduled for running "</span><span class="o">+</span> <span class="n">delayMillis</span><span class="o">/</span><span class="mi">1000</span> <span class="o">+</span> <span class="s">" at "</span> <span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">currentTime</span><span class="o">));</span>

		<span class="nc">ScheduledTask</span> <span class="n">task2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScheduledTask</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
		<span class="n">timer</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">task2</span><span class="o">,</span> <span class="n">delayMillis</span><span class="o">);</span> <span class="c1">//schedule(TimerTask task, long delay)</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">currentThreadName</span><span class="o">+</span><span class="s">"] Task-2 is scheduled for running "</span><span class="o">+</span> <span class="n">delayMillis</span><span class="o">/</span><span class="mi">1000</span> <span class="o">+</span> <span class="s">" at "</span> <span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">currentTime</span><span class="o">));</span>

		<span class="n">task1</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>	<span class="c1">//task1 canceled</span>
		
		<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">12000</span><span class="o">);</span>
		<span class="n">timer</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread ends here..."</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">ScheduledTask</span> <span class="kd">extends</span> <span class="nc">TimerTask</span> <span class="o">{</span>	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">sleepTime</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">taskId</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">SimpleDateFormat</span> <span class="n">dateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"dd-MM-yyyy HH:mm:ss.SSS"</span><span class="o">);</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
		<span class="nc">Date</span> <span class="n">startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">Date</span> <span class="nc">SchdulingForRunningTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="kd">super</span><span class="o">.</span><span class="na">scheduledExecutionTime</span><span class="o">());</span> 
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> 
				<span class="o">+</span> <span class="s">" &gt; Scheduled to run at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="nc">SchdulingForRunningTime</span><span class="o">)</span> 
				<span class="o">+</span> <span class="s">", Actually started at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">startTime</span><span class="o">)</span> 
				<span class="o">+</span> <span class="s">"####"</span><span class="o">);</span>

		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MICROSECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">sleepTime</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span>  
				<span class="o">+</span> <span class="s">" &gt;Finished at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">())</span> 
				<span class="o">+</span> <span class="s">"####"</span><span class="o">);</span>
	<span class="o">}</span>
	

	<span class="kd">public</span> <span class="nf">ScheduledTask</span><span class="o">(</span><span class="kt">long</span> <span class="n">sleepTime</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">sleepTime</span> <span class="o">=</span> <span class="n">sleepTime</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">taskId</span> <span class="o">=</span> <span class="s">"ScheduledTask-"</span> <span class="o">+</span> <span class="n">count</span><span class="o">++;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="cm">/* Utility class to get the future time*/</span>
<span class="kd">class</span> <span class="nc">TimeUtils</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nf">TimeUtils</span><span class="o">()</span> <span class="o">{</span>
		
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="nc">Date</span> <span class="nf">getFutureTime</span><span class="o">(</span><span class="nc">Date</span> <span class="n">initialTime</span><span class="o">,</span> <span class="kt">long</span> <span class="n">millisToAdd</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Calendar</span> <span class="n">cal</span> <span class="o">=</span> <span class="nc">GregorianCalendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
		<span class="n">cal</span><span class="o">.</span><span class="na">setTimeInMillis</span><span class="o">(</span><span class="n">initialTime</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span> <span class="o">+</span> <span class="n">millisToAdd</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">cal</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>결과는 다음과 같다. task0, 1, 2 모두 스케줄링을 한 후 task1을 취소했더니 task0와 task2만 실행되고 task1는 실행되지 않음을 알 수 있다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Main thread starts here...
<span class="o">[</span>main] Current time20-09-2016 23:49:32.518
<span class="o">[</span>main] Task-0 is scheduled <span class="k">for </span>running at 20-09-2016 23:49:32.518
<span class="o">[</span>main] Task-1 is scheduled <span class="k">for </span>running 10 at 20-09-2016 23:49:32.518
<span class="o">[</span>main] Task-2 is scheduled <span class="k">for </span>running 10 at 20-09-2016 23:49:32.518
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 20-09-2016 23:49:37.518, Actually started at 20-09-2016 23:49:37.521####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 20-09-2016 23:49:37.518####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-2 &gt; Scheduled to run at 20-09-2016 23:49:42.519, Actually started at 20-09-2016 23:49:42.522####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-2 &gt;Finished at 20-09-2016 23:49:42.519####</span>
Main thread ends here...
</code></pre></div></div> <h3 id="13-반복되는-태스크-스케줄링하기"> <a href="#13-반복되는-태스크-스케줄링하기" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1.3 반복되는 태스크 스케줄링하기 </h3> <p>아래 메소드를 이용하여 반복되는 태스크를 스케줄링한다.</p> <ul> <li>void schedule(TimerTask task, Date firstTime, long period): firstTime에 처음 실행하고 period 간격으로 계속 실행</li> <li>void schedule(TimerTask task, long delay, long period): 현재부터 delay millisec 이후 처음 실행하고 period 간격으로 계속 실행</li> </ul> <p>간격은 이전 태스크 시작부터 다음 태스크 시작까지이다. 만약 정한 간격보다 길어지면 시작 시간이 밀려서 시작하게 된다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">a1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Calendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.GregorianCalendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Timer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.TimerTask</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SchedulingTasksFixedDelayRepeatedExecution</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">SimpleDateFormat</span> <span class="n">dateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"dd-MM-yyyy HH:mm:ss.SSS"</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argc</span><span class="o">[])</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread starts here..."</span><span class="o">);</span>
	
		<span class="nc">Timer</span> <span class="n">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Timer</span><span class="o">(</span><span class="s">"Timer-thread"</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span> <span class="c1">//false: user thread, true: daemon</span>
		<span class="nc">Date</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">currentThreadName</span><span class="o">+</span><span class="s">"] Current time"</span> <span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">currentTime</span><span class="o">));</span>
		

		<span class="nc">Date</span> <span class="n">scheduledTime</span> <span class="o">=</span> <span class="nc">TimeUtils</span><span class="o">.</span><span class="na">getFutureTime</span><span class="o">(</span><span class="n">currentTime</span><span class="o">,</span> <span class="mi">1000</span><span class="o">);</span>
		<span class="nc">ScheduledTask</span> <span class="n">task0</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScheduledTask</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
		<span class="kt">long</span> <span class="n">periodMillis</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">;</span>
		<span class="n">timer</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">task0</span><span class="o">,</span> <span class="n">scheduledTime</span><span class="o">,</span> <span class="n">periodMillis</span><span class="o">);</span> <span class="c1">//schedule(TimerTask task, Date firstTime, long period)</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">currentThreadName</span><span class="o">+</span><span class="s">"] Task-0 is scheduled for running at "</span> <span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">currentTime</span><span class="o">));</span>
		
		<span class="kt">long</span> <span class="n">delayMillis</span> <span class="o">=</span> <span class="mi">5000</span><span class="o">;</span>
		<span class="n">periodMillis</span> <span class="o">=</span> <span class="mi">5000</span><span class="o">;</span>
		<span class="nc">ScheduledTask</span> <span class="n">task1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScheduledTask</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
		<span class="n">timer</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">task1</span><span class="o">,</span> <span class="n">delayMillis</span><span class="o">,</span> <span class="n">periodMillis</span><span class="o">);</span> <span class="c1">//schedule(TimerTask task, long delay, long period)</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">currentThreadName</span><span class="o">+</span><span class="s">"] Task-1 is scheduled for running "</span><span class="o">+</span> <span class="n">delayMillis</span><span class="o">/</span><span class="mi">1000</span> <span class="o">+</span> <span class="s">" at "</span> <span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">currentTime</span><span class="o">));</span>

		<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">11000</span><span class="o">);</span>
		<span class="n">timer</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread ends here..."</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">ScheduledTask</span> <span class="kd">extends</span> <span class="nc">TimerTask</span> <span class="o">{</span>	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">sleepTime</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">taskId</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">SimpleDateFormat</span> <span class="n">dateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"dd-MM-yyyy HH:mm:ss.SSS"</span><span class="o">);</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
		<span class="nc">Date</span> <span class="n">startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">Date</span> <span class="nc">SchdulingForRunningTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="kd">super</span><span class="o">.</span><span class="na">scheduledExecutionTime</span><span class="o">());</span> 
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> 
				<span class="o">+</span> <span class="s">" &gt; Scheduled to run at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="nc">SchdulingForRunningTime</span><span class="o">)</span> 
				<span class="o">+</span> <span class="s">", Actually started at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">startTime</span><span class="o">)</span> 
				<span class="o">+</span> <span class="s">"####"</span><span class="o">);</span>

		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MICROSECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">sleepTime</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span>  
				<span class="o">+</span> <span class="s">" &gt;Finished at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">())</span> 
				<span class="o">+</span> <span class="s">"####"</span><span class="o">);</span>
	<span class="o">}</span>
	

	<span class="kd">public</span> <span class="nf">ScheduledTask</span><span class="o">(</span><span class="kt">long</span> <span class="n">sleepTime</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">sleepTime</span> <span class="o">=</span> <span class="n">sleepTime</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">taskId</span> <span class="o">=</span> <span class="s">"ScheduledTask-"</span> <span class="o">+</span> <span class="n">count</span><span class="o">++;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="cm">/* Utility class to get the future time*/</span>
<span class="kd">class</span> <span class="nc">TimeUtils</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nf">TimeUtils</span><span class="o">()</span> <span class="o">{</span>
		
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="nc">Date</span> <span class="nf">getFutureTime</span><span class="o">(</span><span class="nc">Date</span> <span class="n">initialTime</span><span class="o">,</span> <span class="kt">long</span> <span class="n">millisToAdd</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Calendar</span> <span class="n">cal</span> <span class="o">=</span> <span class="nc">GregorianCalendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
		<span class="n">cal</span><span class="o">.</span><span class="na">setTimeInMillis</span><span class="o">(</span><span class="n">initialTime</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span> <span class="o">+</span> <span class="n">millisToAdd</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">cal</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>결과는 다음과 같다. task0은 1초간격으로 계속 실행되고, task1은 5초간격으로 실행되다가 timer.cancel()이 호출되면 종료된다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Main thread starts here...
<span class="o">[</span>main] Current time21-09-2016 00:02:31.106
<span class="o">[</span>main] Task-0 is scheduled <span class="k">for </span>running at 21-09-2016 00:02:31.106
<span class="o">[</span>main] Task-1 is scheduled <span class="k">for </span>running 5 at 21-09-2016 00:02:31.106
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:32.109, Actually started at 21-09-2016 00:02:32.109####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:32.109####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:33.111, Actually started at 21-09-2016 00:02:33.111####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:33.111####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:34.115, Actually started at 21-09-2016 00:02:34.115####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:34.115####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:35.119, Actually started at 21-09-2016 00:02:35.119####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:35.119####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-1 &gt; Scheduled to run at 21-09-2016 00:02:36.109, Actually started at 21-09-2016 00:02:36.109####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-1 &gt;Finished at 21-09-2016 00:02:36.109####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:36.120, Actually started at 21-09-2016 00:02:36.120####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:36.120####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:37.122, Actually started at 21-09-2016 00:02:37.122####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:37.122####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:38.124, Actually started at 21-09-2016 00:02:38.124####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:38.124####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:39.128, Actually started at 21-09-2016 00:02:39.128####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:39.128####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:40.129, Actually started at 21-09-2016 00:02:40.129####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:40.129####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-1 &gt; Scheduled to run at 21-09-2016 00:02:41.113, Actually started at 21-09-2016 00:02:41.113####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-1 &gt;Finished at 21-09-2016 00:02:41.113####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:41.129, Actually started at 21-09-2016 00:02:41.129####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:41.129####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:42.131, Actually started at 21-09-2016 00:02:42.131####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:42.131####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:43.136, Actually started at 21-09-2016 00:02:43.136####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:43.136####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:44.139, Actually started at 21-09-2016 00:02:44.139####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:44.139####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt; Scheduled to run at 21-09-2016 00:02:45.144, Actually started at 21-09-2016 00:02:45.144####</span>
<span class="c">#### &lt;Timer-thread,ScheduledTask-0 &gt;Finished at 21-09-2016 00:02:45.144####</span>
Main thread ends here...
</code></pre></div></div> <h3 id="14-fixedrate로-반복되는-태스크-스케줄링하기"> <a href="#14-fixedrate로-반복되는-태스크-스케줄링하기" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 1.4 FixedRate로 반복되는 태스크 스케줄링하기 </h3> <p>아래 메소드를 이용하여 반복되는 태스크를 스케줄링한다.</p> <ul> <li>void scheduleAtFixedRate(TimerTask task, Date firstTime, long period)</li> <li>void scheduleAtFixedRate(TimerTask task, long delay, long period)</li> </ul> <p>시작하는 시점은 맨 처음 태스크 실행 시간을 기준으로 고정되어 계산 된다. FixedRate가 아닌 경우는 바로 이전의 시작을 기준으로 계산한다. 만약 정한 간격보다 길어지면 시작 시간이 밀려서 시작하는 것이 아니라 바로 그 시간에 시작한다. 그러므로 절대 시간에 관한 요구사항을 가진 경우 FixedRate을 사용한다.</p> <p>컨셉을 이해한다면 이전 예와 동일하므로 에제를 가지고 실행하지 않는다.</p> <h2 id="2-executor-태스크-스케줄링"> <a href="#2-executor-태스크-스케줄링" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 2. Executor 태스크 스케줄링 </h2> <h3 id="21-개요"> <a href="#21-개요" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 2.1 개요 </h3> <p>태스크 스케줄링을 위해 Executors는 다음 두개의 쓰레드 풀을 별도로 제공한다.</p> <ul> <li>Single-thread-scheduled-executor: 하나의 쓰레드로 여러 태스크의 스케줄링</li> <li>Scheduled-thread-pool: 여러 쓰레드로 여러 태스크의 스케줄링</li> </ul> <p>Executors 클래스를 사용해 생성하는 것은 다음과 같이 한다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="nc">ScheduledExecutorService</span> <span class="nf">newSingleThreadScheduledExecutor</span><span class="o">()</span>
<span class="kd">static</span> <span class="nc">ScheduledExecutorService</span> <span class="nf">newScheduledThreadPool</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">)</span>
</code></pre></div></div> <p>ScheduledExecutorService 인터페이스는 ExecutorService 인터페이스를 확장한 것으로 다음과 같은 메소드를 정의하고 있다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">schedule</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">command</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="nc">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
<span class="nc">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">schedule</span><span class="o">(</span><span class="nc">Callable</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">callable</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="nc">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
<span class="nc">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">scheduleWithFixedDelay</span><span class="o">(</span><span class="nc">Runnable</span><span class="o">,</span> <span class="kt">long</span> <span class="n">initialDelay</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="nc">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
<span class="nc">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">scheduleWithFixedRate</span><span class="o">(</span><span class="nc">Runnable</span><span class="o">,</span> <span class="kt">long</span> <span class="n">initialDelay</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="nc">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
</code></pre></div></div> <p>일반 쓰레드와 다른 점은 정확한 시간을 지정하여 구동하는 것이 없다는 것이다.</p> <p>ScheduledFuture 인터페이스는 Future 인터페이스와 Delayed 인터페이스를 상속한다. Delayed 인터페이스는 다음의 메소드만을 정의한다. 이것은 다음 실행 스케줄까지 얼마나 남았는지 반환한다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">long</span> <span class="nf">getDelay</span><span class="o">(</span><span class="nc">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
</code></pre></div></div> <h3 id="22-한번-실행되는-태스크-스케줄링하기"> <a href="#22-한번-실행되는-태스크-스케줄링하기" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 2.2 한번 실행되는 태스크 스케줄링하기 </h3> <p>다음 두 메소드를 이용해서 태스크를 한번 스케줄링 할 수 있다.</p> <ul> <li>ScheduledFuture&lt;?&gt; schedule(Runnable command, long delay, TimeUnit unit)</li> <li>ScheduledFuture&lt;?&gt; schedule(Callable<V> callable, long delay, TimeUnit unit)</V></li> </ul> <p>실행은 Single-thread-scheduled-executor 또는 Scheduled-thread-pool 중 하나를 사용하여 스케줄될 수 있다. TimerTask는 필요없으며 Runnable 또는 Callable이면 된다.</p> <p>예제는 다음과 같다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Calendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.GregorianCalendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Timer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.TimerTask</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Callable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutionException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ScheduledExecutorService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ScheduledFuture</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SchedulingTasksFixedDelayRepeatedExecution</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">SimpleDateFormat</span> <span class="n">dateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"dd-MM-yyyy HH:mm:ss.SSS"</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argc</span><span class="o">[])</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread starts here..."</span><span class="o">);</span>
	
		<span class="nc">ScheduledExecutorService</span> <span class="n">execService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newSingleThreadScheduledExecutor</span><span class="o">(</span><span class="k">new</span> <span class="nc">NamedThreadsFactory</span><span class="o">());</span>
		
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">currentThreadName</span><span class="o">+</span><span class="s">"] Current time"</span> <span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">()));</span>
		
		<span class="nc">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">schedFuture1</span> <span class="o">=</span> <span class="n">execService</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="k">new</span> <span class="nc">ScheduledRunnableTask</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="mi">2</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
		<span class="nc">ScheduledFuture</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">schedFuture2</span> <span class="o">=</span> <span class="n">execService</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="k">new</span> <span class="nc">ScheduledCallableTask</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="mi">4</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
		
		<span class="n">execService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Task1 result = "</span> <span class="o">+</span> <span class="n">schedFuture1</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Task2 result = "</span> <span class="o">+</span> <span class="n">schedFuture2</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread ends here..."</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">NamedThreadsFactory</span> <span class="kd">implements</span> <span class="nc">ThreadFactory</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nc">Name</span> <span class="o">=</span> <span class="s">"MyThread-"</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Thread</span> <span class="nf">newThread</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="nc">Name</span> <span class="o">+</span> <span class="o">++</span><span class="n">count</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">ScheduledRunnableTask</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">sleepTime</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">taskId</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">SimpleDateFormat</span> <span class="n">dateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"dd-MM-yyyy HH:mm:ss.SSS"</span><span class="o">);</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
		<span class="nc">Date</span> <span class="n">startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> 
				<span class="o">+</span> <span class="s">" &gt; Actually started at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">startTime</span><span class="o">)</span> 
				<span class="o">+</span> <span class="s">"####"</span><span class="o">);</span>

		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MICROSECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">sleepTime</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span>  
				<span class="o">+</span> <span class="s">" &gt;Finished at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">())</span> 
				<span class="o">+</span> <span class="s">"####"</span><span class="o">);</span>
	<span class="o">}</span>
	

	<span class="kd">public</span> <span class="nf">ScheduledRunnableTask</span><span class="o">(</span><span class="kt">long</span> <span class="n">sleepTime</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">sleepTime</span> <span class="o">=</span> <span class="n">sleepTime</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">taskId</span> <span class="o">=</span> <span class="s">"ScheduledRunnableTask-"</span> <span class="o">+</span> <span class="n">count</span><span class="o">++;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">ScheduledCallableTask</span> <span class="kd">implements</span> <span class="nc">Callable</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">sleepTime</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">taskId</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">SimpleDateFormat</span> <span class="n">dateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"dd-MM-yyyy HH:mm:ss.SSS"</span><span class="o">);</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="nc">Date</span> <span class="n">startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> 
				<span class="o">+</span> <span class="s">" &gt; Actually started at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">startTime</span><span class="o">)</span> 
				<span class="o">+</span> <span class="s">"####"</span><span class="o">);</span>

		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MICROSECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">sleepTime</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span>  
				<span class="o">+</span> <span class="s">" &gt;Finished at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">())</span> 
				<span class="o">+</span> <span class="s">"####"</span><span class="o">);</span>
		<span class="k">return</span> <span class="mi">10</span><span class="o">;</span> <span class="c1">//whatever</span>
	<span class="o">}</span>
	

	<span class="kd">public</span> <span class="nf">ScheduledCallableTask</span><span class="o">(</span><span class="kt">long</span> <span class="n">sleepTime</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">sleepTime</span> <span class="o">=</span> <span class="n">sleepTime</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">taskId</span> <span class="o">=</span> <span class="s">"ScheduledCallableTask-"</span> <span class="o">+</span> <span class="n">count</span><span class="o">++;</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <p>결과는 다음과 같다. Runnable 태스크가 2초, Callable이 4초후에 실행되었다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Main thread starts here...
<span class="o">[</span>main] Current time21-09-2016 00:42:41.359
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt; Actually started at 21-09-2016 00:42:43.365####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt;Finished at 21-09-2016 00:42:43.365####</span>
Task1 result <span class="o">=</span> null
<span class="c">#### &lt;MyThread-1,ScheduledCallableTask-0 &gt; Actually started at 21-09-2016 00:42:45.362####</span>
<span class="c">#### &lt;MyThread-1,ScheduledCallableTask-0 &gt;Finished at 21-09-2016 00:42:45.362####</span>
Task2 result <span class="o">=</span> 10
Main thread ends here...
</code></pre></div></div> <h3 id="23-반복-실행되는-태스크-스케줄링하기"> <a href="#23-반복-실행되는-태스크-스케줄링하기" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 2.3 반복 실행되는 태스크 스케줄링하기 </h3> <p>반복 실행되는 태스크는 다음의 메소드를 이용한다.</p> <ul> <li>ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable, long initialDelay, long delay, TimeUnit unit)</li> </ul> <p>주의할 점은 다음과 같다.</p> <ul> <li>인터벌은 이전 태스크 실행이 언제 끝났느냐에 따라 달라진다. 일반 쓰레드가 시작을 기준으로 정하는 것과 구별된다.</li> <li>Callable 태스크의 반복은 지원하지 않는다. Runnable만 지원된다.</li> </ul> <p>예제는 다음과 같다. 4초후에 태스크가 실행되고 매 2초마다 반복되는 것이다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Calendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.GregorianCalendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Timer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.TimerTask</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Callable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutionException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ScheduledExecutorService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ScheduledFuture</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SchedulingTasksFixedDelayRepeatedExecution</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">SimpleDateFormat</span> <span class="n">dateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"dd-MM-yyyy HH:mm:ss.SSS"</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argc</span><span class="o">[])</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread starts here..."</span><span class="o">);</span>
	
		<span class="nc">ScheduledExecutorService</span> <span class="n">execService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newSingleThreadScheduledExecutor</span><span class="o">(</span><span class="k">new</span> <span class="nc">NamedThreadsFactory</span><span class="o">());</span>
		
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">currentThreadName</span><span class="o">+</span><span class="s">"] Current time"</span> <span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">()));</span>
		
		<span class="c1">//ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable, long initialDelay, long delay, TimeUnit unit)</span>
		<span class="nc">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">schedFuture</span> <span class="o">=</span> <span class="n">execService</span><span class="o">.</span><span class="na">scheduleWithFixedDelay</span><span class="o">(</span><span class="k">new</span> <span class="nc">ScheduledRunnableTask</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
		
		<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">10000</span><span class="o">);</span>
		<span class="n">execService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread ends here..."</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">NamedThreadsFactory</span> <span class="kd">implements</span> <span class="nc">ThreadFactory</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nc">Name</span> <span class="o">=</span> <span class="s">"MyThread-"</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Thread</span> <span class="nf">newThread</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="nc">Name</span> <span class="o">+</span> <span class="o">++</span><span class="n">count</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">ScheduledRunnableTask</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">sleepTime</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">taskId</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">SimpleDateFormat</span> <span class="n">dateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"dd-MM-yyyy HH:mm:ss.SSS"</span><span class="o">);</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
		<span class="nc">Date</span> <span class="n">startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span> 
				<span class="o">+</span> <span class="s">" &gt; Actually started at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">startTime</span><span class="o">)</span> 
				<span class="o">+</span> <span class="s">"####"</span><span class="o">);</span>

		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MICROSECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">sleepTime</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"#### &lt;"</span> <span class="o">+</span> <span class="n">currentThreadName</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="n">taskId</span>  
				<span class="o">+</span> <span class="s">" &gt;Finished at "</span>
				<span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">())</span> 
				<span class="o">+</span> <span class="s">"####"</span><span class="o">);</span>
	<span class="o">}</span>
	

	<span class="kd">public</span> <span class="nf">ScheduledRunnableTask</span><span class="o">(</span><span class="kt">long</span> <span class="n">sleepTime</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">sleepTime</span> <span class="o">=</span> <span class="n">sleepTime</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">taskId</span> <span class="o">=</span> <span class="s">"ScheduledRunnableTask-"</span> <span class="o">+</span> <span class="n">count</span><span class="o">++;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>결과는 다음과 같다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Main thread starts here...
<span class="o">[</span>main] Current time21-09-2016 00:50:15.020
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt; Actually started at 21-09-2016 00:50:19.027####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt;Finished at 21-09-2016 00:50:19.027####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt; Actually started at 21-09-2016 00:50:21.031####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt;Finished at 21-09-2016 00:50:21.031####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt; Actually started at 21-09-2016 00:50:23.035####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt;Finished at 21-09-2016 00:50:23.036####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt; Actually started at 21-09-2016 00:50:25.039####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt;Finished at 21-09-2016 00:50:25.039####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt; Actually started at 21-09-2016 00:50:27.043####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt;Finished at 21-09-2016 00:50:27.043####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt; Actually started at 21-09-2016 00:50:29.048####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt;Finished at 21-09-2016 00:50:29.048####</span>
Main thread ends here...
</code></pre></div></div> <h3 id="24-fixedrate로-반복-실행되는-태스크-스케줄링하기"> <a href="#24-fixedrate로-반복-실행되는-태스크-스케줄링하기" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 2.4 FixedRate로 반복 실행되는 태스크 스케줄링하기 </h3> <p>반복 실행되는 태스크는 다음의 메소드를 이용한다.</p> <ul> <li>ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable, long initialDelay, long delay, TimeUnit unit)</li> </ul> <p>주의할 점은 다음과 같다.</p> <ul> <li>맨처음 태스크의 <strong>시작 시간</strong>을 기준으로 각각 실행이 스케줄 된다. 일반 쓰레드의 FixedRate와 동일한 점이다.</li> <li>Callable 태스크의 반복은 지원하지 않는다. Runnable만 지원된다.</li> </ul> <p>예제는 다음과 같다. 4초후에 태스크가 실행되고 매 2초마다 반복되는 것으로 scheduleWithFixedDelay의 경우와 메소드 이름만 다를 뿐이다.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SchedulingTasksFixedDelayRepeatedExecution</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">SimpleDateFormat</span> <span class="n">dateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"dd-MM-yyyy HH:mm:ss.SSS"</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argc</span><span class="o">[])</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">currentThreadName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread starts here..."</span><span class="o">);</span>
	
		<span class="nc">ScheduledExecutorService</span> <span class="n">execService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newSingleThreadScheduledExecutor</span><span class="o">(</span><span class="k">new</span> <span class="nc">NamedThreadsFactory</span><span class="o">());</span>
		
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">currentThreadName</span><span class="o">+</span><span class="s">"] Current time"</span> <span class="o">+</span> <span class="n">dateFormatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">()));</span>
		
		<span class="c1">//ScheduledFuture&lt;?&gt; schedFuture = execService.scheduleWithFixedDelay(new ScheduledRunnableTask(0), 4, 2, TimeUnit.SECONDS);</span>
		<span class="nc">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">schedFuture</span> <span class="o">=</span> <span class="n">execService</span><span class="o">.</span><span class="na">scheduleAtFixedRate</span><span class="o">(</span><span class="k">new</span> <span class="nc">ScheduledRunnableTask</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
		
		<span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">10000</span><span class="o">);</span>
		<span class="n">execService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Main thread ends here..."</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>결과는 다음과 같다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Main thread starts here...
<span class="o">[</span>main] Current time21-09-2016 00:54:42.461
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt; Actually started at 21-09-2016 00:54:46.467####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt;Finished at 21-09-2016 00:54:46.468####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt; Actually started at 21-09-2016 00:54:48.464####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt;Finished at 21-09-2016 00:54:48.464####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt; Actually started at 21-09-2016 00:54:50.466####</span>
<span class="c">#### &lt;MyThread-1,ScheduledRunnableTask-0 &gt;Finished at 21-09-2016 00:54:50.466####</span>
Main thread ends here...
</code></pre></div></div> </div> </div> </div> </div> </body> </html>
